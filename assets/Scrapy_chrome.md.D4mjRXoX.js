import{_ as n,c as a,o as l,ah as p}from"./chunks/framework.BrJYEL96.js";const b=JSON.parse('{"title":"chrome","description":"","frontmatter":{},"headers":[],"relativePath":"Scrapy/chrome.md","filePath":"Scrapy/chrome.md","lastUpdated":1754470268000}'),e={name:"Scrapy/chrome.md"};function o(r,s,c,t,i,B){return l(),a("div",null,s[0]||(s[0]=[p(`<h1 id="chrome" tabindex="-1">chrome <a class="header-anchor" href="#chrome" aria-label="Permalink to &quot;chrome&quot;">​</a></h1><h2 id="创建新浏览器" tabindex="-1">创建新浏览器 <a class="header-anchor" href="#创建新浏览器" aria-label="Permalink to &quot;创建新浏览器&quot;">​</a></h2><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">/Applications/Google\\</span><span style="color:#98C379;"> Chrome.app/Contents/MacOS/Google</span><span style="color:#56B6C2;">\\ </span><span style="color:#98C379;">Chrome</span><span style="color:#D19A66;"> --remote-debugging-port=9221</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>保持命令行运行浏览器，执行一下操作</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> webdriver</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">options </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">ChromeOptions</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">options.</span><span style="color:#61AFEF;">add_experimental_option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;debuggerAddress&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;127.0.0.1:9221&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">cb </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">options</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">options)</span></span>
<span class="line"><span style="color:#ABB2BF;">cb.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;https://www.zhihu.com&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(cb.title)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>查看Google浏览器相关信息：</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;">chrome</span><span style="color:#ABB2BF;">:</span><span style="color:#7F848E;font-style:italic;">//version/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="修改chrome用户存储地址" tabindex="-1">修改Chrome用户存储地址 <a class="header-anchor" href="#修改chrome用户存储地址" aria-label="Permalink to &quot;修改Chrome用户存储地址&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> webdriver</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">user_path </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &#39;Users/home/love/Downloads&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;">options </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">ChromeOptions</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;--user-data-dir=</span><span style="color:#D19A66;">{}</span><span style="color:#98C379;">&#39;</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">format</span><span style="color:#ABB2BF;">(user_path))</span></span>
<span class="line"><span style="color:#ABB2BF;">options.</span><span style="color:#61AFEF;">add_experimental_option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;debuggerAddress&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;127.0.0.1:9221&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">cb </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">options</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">options)</span></span>
<span class="line"><span style="color:#ABB2BF;">cb.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;https://www.zhihu.com&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(cb.title)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="使用webdriver" tabindex="-1">使用webdriver <a class="header-anchor" href="#使用webdriver" aria-label="Permalink to &quot;使用webdriver&quot;">​</a></h3><div class="language-py line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> time </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> sleep</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> webdriver</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.chrome.service </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Service</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.common.by </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> By</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">service  </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Service</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;./chromedriver&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">service</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">service)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://www.baidu.com&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="无头模式" tabindex="-1">无头模式 <a class="header-anchor" href="#无头模式" aria-label="Permalink to &quot;无头模式&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> time </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> sleep</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> webdriver</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.chrome.service </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Service</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.common.by </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> By</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.chrome.options </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Options</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">service </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Service</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;./chromedriver&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">chrome_options </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Options</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">chrome_options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--headless&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">chrome_options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--window-size=1920,1080&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">service</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">service, </span><span style="color:#E06C75;font-style:italic;">options</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">chrome_options)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://www.imooc.com&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">text </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">XPATH</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;//*[@id=&quot;main&quot;]/div[3]/div[1]/div[1]/h3/ul/li[1]/a&#39;</span><span style="color:#ABB2BF;">).text</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(text)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="图片懒加载" tabindex="-1">图片懒加载 <a class="header-anchor" href="#图片懒加载" aria-label="Permalink to &quot;图片懒加载&quot;">​</a></h4><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> time </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> sleep</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> webdriver</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.chrome.service </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Service</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.common.by </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> By</span></span>
<span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium.webdriver.chrome.options </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> Options</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">service </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Service</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;./chromedriver&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">chrome_options </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> Options</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#设置无头模式</span></span>
<span class="line"><span style="color:#ABB2BF;">chrome_options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--headless&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">chrome_options.</span><span style="color:#61AFEF;">add_argument</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;--window-size=1920,1080&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 不加载图片</span></span>
<span class="line"><span style="color:#ABB2BF;">prefs </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#98C379;">&#39;profile.managed_default_content_settings.images&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">chrome_options.</span><span style="color:#61AFEF;">add_experimental_option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;prefs&#39;</span><span style="color:#ABB2BF;">, prefs)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 初始化</span></span>
<span class="line"><span style="color:#ABB2BF;">driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">service</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">service, </span><span style="color:#E06C75;font-style:italic;">options</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">chrome_options)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://www.imooc.com&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">text </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(By.</span><span style="color:#D19A66;">XPATH</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;//*[@id=&quot;main&quot;]/div[3]/div[1]/div[1]/h3/ul/li[2]/a&#39;</span><span style="color:#ABB2BF;">).text</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(text)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">sleep</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">quit</span><span style="color:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="浏览器加载script脚本" tabindex="-1">浏览器加载script脚本 <a class="header-anchor" href="#浏览器加载script脚本" aria-label="Permalink to &quot;浏览器加载script脚本&quot;">​</a></h3><h4 id="_1-注入并执行-javascript-脚本" tabindex="-1"><strong>1. 注入并执行 JavaScript 脚本</strong> <a class="header-anchor" href="#_1-注入并执行-javascript-脚本" aria-label="Permalink to &quot;**1. 注入并执行 JavaScript 脚本**&quot;">​</a></h4><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">from</span><span style="color:#ABB2BF;"> selenium </span><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> webdriver</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">driver </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> webdriver.</span><span style="color:#61AFEF;">Chrome</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://example.com&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 执行 JavaScript 脚本</span></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;alert(&#39;Hello, Selenium!&#39;);&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_2-注入外部-javascript-文件" tabindex="-1"><strong>2. 注入外部 JavaScript 文件</strong> <a class="header-anchor" href="#_2-注入外部-javascript-文件" aria-label="Permalink to &quot;**2. 注入外部 JavaScript 文件**&quot;">​</a></h4><p>如果你想加载一个外部 <code>.js</code> 文件，可以读取文件内容并用 <code>execute_script()</code> 执行：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">with</span><span style="color:#56B6C2;"> open</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;path/to/your_script.js&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;r&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> js_file:</span></span>
<span class="line"><span style="color:#ABB2BF;">    js_code </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> js_file.</span><span style="color:#61AFEF;">read</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(js_code)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_3-在页面加载前注入脚本-使用-execute-cdp-cmd" tabindex="-1"><strong>3. 在页面加载前注入脚本（使用 <code>execute_cdp_cmd</code>）</strong> <a class="header-anchor" href="#_3-在页面加载前注入脚本-使用-execute-cdp-cmd" aria-label="Permalink to &quot;**3. 在页面加载前注入脚本（使用 \`execute_cdp_cmd\`）**&quot;">​</a></h4><p>如果你需要在页面加载<strong>之前</strong>注入脚本（例如修改 <code>navigator.webdriver</code> 以绕过检测），可以使用 Chrome DevTools Protocol (CDP)：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">execute_cdp_cmd</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Page.addScriptToEvaluateOnNewDocument&quot;</span><span style="color:#ABB2BF;">, {</span></span>
<span class="line"><span style="color:#98C379;">    &quot;source&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">        Object.defineProperty(navigator, &#39;webdriver&#39;, {</span></span>
<span class="line"><span style="color:#98C379;">            get: () =&gt; false</span></span>
<span class="line"><span style="color:#98C379;">        });</span></span>
<span class="line"><span style="color:#98C379;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;https://example.com&quot;</span><span style="color:#ABB2BF;">)  </span><span style="color:#7F848E;font-style:italic;"># 脚本会在页面加载前执行</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_4-在特定元素上执行脚本" tabindex="-1"><strong>4. 在特定元素上执行脚本</strong> <a class="header-anchor" href="#_4-在特定元素上执行脚本" aria-label="Permalink to &quot;**4. 在特定元素上执行脚本**&quot;">​</a></h4><p>你可以结合 <code>arguments[0]</code> 来操作 DOM 元素：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">element </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">find_element</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;id&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;my-element&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;arguments[0].style.border = &#39;3px solid red&#39;;&quot;</span><span style="color:#ABB2BF;">, element)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_5-获取-javascript-执行结果" tabindex="-1"><strong>5. 获取 JavaScript 执行结果</strong> <a class="header-anchor" href="#_5-获取-javascript-执行结果" aria-label="Permalink to &quot;**5. 获取 JavaScript 执行结果**&quot;">​</a></h4><p><code>execute_script()</code> 可以返回 JavaScript 的执行结果：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">title </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> driver.</span><span style="color:#61AFEF;">execute_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;return document.title;&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#56B6C2;">print</span><span style="color:#ABB2BF;">(title)  </span><span style="color:#7F848E;font-style:italic;"># 输出当前页面标题</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_6-异步脚本执行-execute-async-script" tabindex="-1"><strong>6. 异步脚本执行（<code>execute_async_script</code>）</strong> <a class="header-anchor" href="#_6-异步脚本执行-execute-async-script" aria-label="Permalink to &quot;**6. 异步脚本执行（\`execute_async_script\`）**&quot;">​</a></h4><p>如果脚本包含异步操作（如 <code>setTimeout</code> 或 <code>fetch</code>），可以使用 <code>execute_async_script</code>：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">driver.</span><span style="color:#61AFEF;">execute_async_script</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#98C379;">    const callback = arguments[arguments.length - 1];</span></span>
<span class="line"><span style="color:#98C379;">    setTimeout(() =&gt; {</span></span>
<span class="line"><span style="color:#98C379;">        callback(&quot;Done after 2 seconds!&quot;);</span></span>
<span class="line"><span style="color:#98C379;">    }, 2000);</span></span>
<span class="line"><span style="color:#98C379;">&quot;&quot;&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div>`,33)]))}const d=n(e,[["render",o]]);export{b as __pageData,d as default};
