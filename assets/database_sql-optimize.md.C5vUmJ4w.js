import{_ as n,c as a,o as l,ah as p}from"./chunks/framework.BrJYEL96.js";const b=JSON.parse('{"title":"SQL优化","description":"","frontmatter":{},"headers":[],"relativePath":"database/sql-optimize.md","filePath":"database/sql-optimize.md","lastUpdated":1738322845000}'),e={name:"database/sql-optimize.md"};function o(r,s,c,t,i,y){return l(),a("div",null,s[0]||(s[0]=[p(`<h1 id="sql优化" tabindex="-1">SQL优化 <a class="header-anchor" href="#sql优化" aria-label="Permalink to &quot;SQL优化&quot;">​</a></h1><table tabindex="0"><thead><tr><th>web</th><th>des</th></tr></thead><tbody><tr><td><a href="https://www.percona.com/mysql/software" target="_blank" rel="noreferrer">percona</a></td><td><a href="https://www.percona.com/percona-toolkit" target="_blank" rel="noreferrer">pt-query-digest</a></td></tr></tbody></table><h2 id="percona安装" tabindex="-1">percona安装 <a class="header-anchor" href="#percona安装" aria-label="Permalink to &quot;percona安装&quot;">​</a></h2><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># download</span></span>
<span class="line"><span style="color:#61AFEF;">wget</span><span style="color:#98C379;"> https://downloads.percona.com/downloads/percona-toolkit/3.0.13/binary/redhat/7/x86_64/percona-toolkit-3.0.13-1.el7.x86_64.rpm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># install dependency</span></span>
<span class="line"><span style="color:#61AFEF;">yum</span><span style="color:#98C379;"> install</span><span style="color:#D19A66;"> -y</span><span style="color:#98C379;"> perl-DBD-MySQL.x86_64</span><span style="color:#98C379;"> perl-DBI.x86_64</span><span style="color:#98C379;"> perl-Time-HiRes.x86_64</span><span style="color:#98C379;"> perl-IO-Socket-SSL.noarch</span><span style="color:#98C379;"> perl-TermReadKey.x86_64</span><span style="color:#98C379;"> perl-Digest-MD5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># install </span></span>
<span class="line"><span style="color:#61AFEF;">rpm</span><span style="color:#D19A66;"> -ivh</span><span style="color:#98C379;"> percona-toolkit-3.0.13-1.el7.x86_64.rpm</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="percona使用" tabindex="-1">percona使用 <a class="header-anchor" href="#percona使用" aria-label="Permalink to &quot;percona使用&quot;">​</a></h2><p>查询Mysql默认查询时间</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">show variables </span><span style="color:#C678DD;">like</span><span style="color:#98C379;"> &#39;long_query_time&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;"># 设置100毫秒查询时间</span></span>
<span class="line"><span style="color:#C678DD;">set</span><span style="color:#C678DD;"> global</span><span style="color:#ABB2BF;"> long_query_time </span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">001</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;"># show slow </span><span style="color:#C678DD;">log</span><span style="color:#ABB2BF;"> setting</span></span>
<span class="line"><span style="color:#ABB2BF;">show variables </span><span style="color:#C678DD;">like</span><span style="color:#98C379;"> &#39;slow_query_log&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;"># show slow </span><span style="color:#C678DD;">log</span><span style="color:#ABB2BF;"> setting </span><span style="color:#C678DD;">file</span></span>
<span class="line"><span style="color:#ABB2BF;">show variables </span><span style="color:#C678DD;">like</span><span style="color:#98C379;"> &#39;slow_query_log_file&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;"># </span><span style="color:#C678DD;">start</span><span style="color:#ABB2BF;"> slow query </span><span style="color:#C678DD;">log</span></span>
<span class="line"><span style="color:#C678DD;">set</span><span style="color:#C678DD;"> global</span><span style="color:#ABB2BF;"> slow_query_log </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> on</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">use</span><span style="color:#ABB2BF;"> imc_db;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">select</span><span style="color:#56B6C2;"> count</span><span style="color:#ABB2BF;">(*) </span><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> imc_db</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">imc_user</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;"># 此时已经生成慢查询日志文件 在log目录下</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">SELECT</span><span style="color:#ABB2BF;"> @@</span><span style="color:#D19A66;">session</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">transaction_isolation</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;"># </span><span style="color:#C678DD;">Time</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">2025</span><span style="color:#ABB2BF;">-</span><span style="color:#D19A66;">01</span><span style="color:#ABB2BF;">-29T13:</span><span style="color:#D19A66;">32</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">54</span><span style="color:#ABB2BF;">.479542Z</span></span>
<span class="line"><span style="color:#ABB2BF;"># User</span><span style="color:#E06C75;">@Host</span><span style="color:#ABB2BF;">: imooc</span><span style="color:#E06C75;">[imooc]</span><span style="color:#ABB2BF;"> @  </span><span style="color:#E06C75;">[192.168.0.90]</span><span style="color:#ABB2BF;">  Id:    </span><span style="color:#D19A66;">12</span></span>
<span class="line"><span style="color:#ABB2BF;"># Query_time: </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">000016</span><span style="color:#ABB2BF;">  Lock_time: </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">000000</span><span style="color:#ABB2BF;"> Rows_sent: </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">  Rows_examined: </span><span style="color:#D19A66;">0</span></span>
<span class="line"><span style="color:#C678DD;">SET</span><span style="color:#C678DD;"> timestamp</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">1738157574</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="mysqldumpslow-的使用" tabindex="-1">mysqldumpslow 的使用 <a class="header-anchor" href="#mysqldumpslow-的使用" aria-label="Permalink to &quot;mysqldumpslow 的使用&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">mysqldumpslow</span><span style="color:#98C379;"> /usr/local/mysql/sql_log/slowlog.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Count:</span><span style="color:#D19A66;"> 1</span><span style="color:#98C379;">  Time=0.01s</span><span style="color:#ABB2BF;"> (0s)  </span><span style="color:#E06C75;">Lock</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">0.00s</span><span style="color:#61AFEF;"> (0s</span><span style="color:#ABB2BF;">)  </span><span style="color:#E06C75;">Rows</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">0.0</span><span style="color:#61AFEF;"> (0</span><span style="color:#ABB2BF;">), imooc[imooc]@[192.168.0.20]</span></span>
<span class="line"><span style="color:#61AFEF;">  /*</span><span style="color:#98C379;"> ApplicationName=PyCharm</span><span style="color:#98C379;"> N.N.N</span><span style="color:#E5C07B;"> *</span><span style="color:#98C379;">/</span><span style="color:#98C379;"> set</span><span style="color:#98C379;"> global</span><span style="color:#98C379;"> slow_query_log</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> on</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Count:</span><span style="color:#D19A66;"> 5</span><span style="color:#98C379;">  Time=0.00s</span><span style="color:#ABB2BF;"> (0s)  </span><span style="color:#E06C75;">Lock</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">0.00s</span><span style="color:#61AFEF;"> (0s</span><span style="color:#ABB2BF;">)  </span><span style="color:#E06C75;">Rows</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">1.0</span><span style="color:#61AFEF;"> (5</span><span style="color:#ABB2BF;">), imooc[imooc]@[192.168.0.20]</span></span>
<span class="line"><span style="color:#61AFEF;">  SELECT</span><span style="color:#98C379;"> @@session.transaction_isolation</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Count:</span><span style="color:#D19A66;"> 2</span><span style="color:#98C379;">  Time=0.00s</span><span style="color:#ABB2BF;"> (0s)  </span><span style="color:#E06C75;">Lock</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">0.00s</span><span style="color:#61AFEF;"> (0s</span><span style="color:#ABB2BF;">)  </span><span style="color:#E06C75;">Rows</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">1.0</span><span style="color:#61AFEF;"> (2</span><span style="color:#ABB2BF;">), imooc[imooc]@[192.168.0.20]</span></span>
<span class="line"><span style="color:#61AFEF;">  SELECT</span><span style="color:#98C379;"> @@session.transaction_read_only</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="pt-query-digest-的使用" tabindex="-1">pt-query-digest 的使用 <a class="header-anchor" href="#pt-query-digest-的使用" aria-label="Permalink to &quot;pt-query-digest 的使用&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pt-query-digest</span><span style="color:#98C379;"> slowlog.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Query 1: 0.04 QPS, 0.00x concurrency, ID 0x8242DDD855F27A944F73BFBC4EFC5A27 at byte 3582</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Scores: V/M = 0.01</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Time range: 2025-01-29T13:29:47 to 2025-01-29T13:30:36</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Attribute    pct   total     min     max     avg     95%  stddev  median</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># ============ === ======= ======= ======= ======= ======= ======= =======</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Count          6       2</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Exec time     44    10ms   505us    10ms     5ms    10ms     7ms     5ms</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Lock time    100    10ms   222us    10ms     5ms    10ms     7ms     5ms</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Rows sent     14       2       1       1       1       1       0       1</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Rows examine   0       0       0       0       0       0       0       0</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Query size    10     150      75      75      75      75       0      75</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># String:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Hosts        192.168.0.20</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Users        imooc</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Query_time distribution</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#   1us</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#  10us</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 100us  ################################################################</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#   1ms</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#  10ms  ################################################################</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 100ms</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#    1s</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#  10s+</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Tables</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#    SHOW TABLE STATUS FROM \`imc_db\` LIKE &#39;imc_user&#39;\\G</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#    SHOW CREATE TABLE \`imc_db\`.\`imc_user\`\\G</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># EXPLAIN /*!50100 PARTITIONS*/</span></span>
<span class="line"><span style="color:#61AFEF;">/*</span><span style="color:#98C379;"> ApplicationName=PyCharm</span><span style="color:#D19A66;"> 2024.3.2</span><span style="color:#E5C07B;"> *</span><span style="color:#98C379;">/</span><span style="color:#98C379;"> select</span><span style="color:#98C379;"> count</span><span style="color:#ABB2BF;">(*) </span><span style="color:#98C379;">from</span><span style="color:#98C379;"> imc_db.imc_user</span><span style="color:#56B6C2;">\\G</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="时间监控mysql" tabindex="-1">时间监控mysql <a class="header-anchor" href="#时间监控mysql" aria-label="Permalink to &quot;时间监控mysql&quot;">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> id, </span><span style="color:#98C379;">\`user\`</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">\`host\`</span><span style="color:#ABB2BF;">, DB, command, </span><span style="color:#98C379;">\`time\`</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">state</span><span style="color:#ABB2BF;">, info </span><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> information_schema</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">PROCESSLIST</span><span style="color:#C678DD;"> where</span><span style="color:#C678DD;"> time</span><span style="color:#56B6C2;"> &gt;</span><span style="color:#D19A66;"> 60</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">+</span><span style="color:#7F848E;font-style:italic;">----+-----------------+--------------------+------+---------+------+------------------------+------+</span></span>
<span class="line"><span style="color:#ABB2BF;">| id | user            | host               | DB   | command | </span><span style="color:#C678DD;">time</span><span style="color:#ABB2BF;"> | </span><span style="color:#C678DD;">state</span><span style="color:#ABB2BF;">                  | info |</span></span>
<span class="line"><span style="color:#ABB2BF;">+</span><span style="color:#7F848E;font-style:italic;">----+-----------------+--------------------+------+---------+------+------------------------+------+</span></span>
<span class="line"><span style="color:#ABB2BF;">|  </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;"> | event_scheduler | localhost          | </span><span style="color:#C678DD;">NULL</span><span style="color:#ABB2BF;"> | Daemon  | </span><span style="color:#D19A66;">2418</span><span style="color:#ABB2BF;"> | Waiting </span><span style="color:#C678DD;">on</span><span style="color:#C678DD;"> empty</span><span style="color:#C678DD;"> queue</span><span style="color:#ABB2BF;"> | </span><span style="color:#C678DD;">NULL</span><span style="color:#ABB2BF;"> |</span></span>
<span class="line"><span style="color:#ABB2BF;">| </span><span style="color:#D19A66;">13</span><span style="color:#ABB2BF;"> | imooc           | </span><span style="color:#D19A66;">192</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">168</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">20</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">58807</span><span style="color:#ABB2BF;"> | </span><span style="color:#C678DD;">NULL</span><span style="color:#ABB2BF;"> | Sleep   |  </span><span style="color:#D19A66;">334</span><span style="color:#ABB2BF;"> |                        | </span><span style="color:#C678DD;">NULL</span><span style="color:#ABB2BF;"> |</span></span>
<span class="line"><span style="color:#ABB2BF;">+</span><span style="color:#7F848E;font-style:italic;">----+-----------------+--------------------+------+---------+------+------------------------+------+</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="sql执行计划" tabindex="-1">sql执行计划 <a class="header-anchor" href="#sql执行计划" aria-label="Permalink to &quot;sql执行计划&quot;">​</a></h3><p><code>explain</code>+SQL语句，ID越大，查询优先值越高。</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">explain </span><span style="color:#C678DD;">select</span><span style="color:#56B6C2;"> count</span><span style="color:#ABB2BF;">(*) </span><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> imc_db</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">imc_user</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="阻塞" tabindex="-1">阻塞 <a class="header-anchor" href="#阻塞" aria-label="Permalink to &quot;阻塞&quot;">​</a></h2><h3 id="设置数据读取级别" tabindex="-1">设置数据读取级别 <a class="header-anchor" href="#设置数据读取级别" aria-label="Permalink to &quot;设置数据读取级别&quot;">​</a></h3><ul><li>顺序读serializable</li><li>重复读repeatable read</li><li>读已提交read committed</li><li>读未提交read uncommited</li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;"># 设置读取隔离级别</span></span>
<span class="line"><span style="color:#C678DD;">set</span><span style="color:#C678DD;"> session</span><span style="color:#C678DD;"> transaction</span><span style="color:#C678DD;"> isolation</span><span style="color:#C678DD;"> level</span><span style="color:#C678DD;"> repeatable</span><span style="color:#C678DD;"> read</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">#回滚</span></span>
<span class="line"><span style="color:#C678DD;">rollback</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">#提交</span></span>
<span class="line"><span style="color:#C678DD;">commit</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="查询阻塞" tabindex="-1">查询阻塞 <a class="header-anchor" href="#查询阻塞" aria-label="Permalink to &quot;查询阻塞&quot;">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> waiting_pid </span><span style="color:#C678DD;">as</span><span style="color:#98C379;"> &#39;blocked pid&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">waiting_query </span><span style="color:#C678DD;">as</span><span style="color:#98C379;"> &#39;blocked sql&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">blocking_pid </span><span style="color:#C678DD;">as</span><span style="color:#98C379;"> &#39;running pid&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">blocking_query </span><span style="color:#C678DD;">as</span><span style="color:#98C379;"> &#39;running sql&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">wait_age </span><span style="color:#C678DD;">as</span><span style="color:#98C379;"> &#39;blocked time&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">sql_kill_blocking_query </span><span style="color:#C678DD;">as</span><span style="color:#98C379;"> &#39;info&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">where</span><span style="color:#ABB2BF;"> (unix_timestamp() - unix_timestamp(wait_started)) </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 30</span><span style="color:#ABB2BF;">; # </span><span style="color:#C678DD;">where</span><span style="color:#ABB2BF;"> 设置阻塞时间，可以不加，即查询全部</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="死锁" tabindex="-1">死锁 <a class="header-anchor" href="#死锁" aria-label="Permalink to &quot;死锁&quot;">​</a></h2><p>查看和记录死锁</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">set</span><span style="color:#C678DD;"> global</span><span style="color:#ABB2BF;"> innodb_print_all_deadlocks </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> on</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,25)]))}const m=n(e,[["render",o]]);export{b as __pageData,m as default};
