import{_ as n,c as a,o as p,ah as l}from"./chunks/framework.BrJYEL96.js";const A=JSON.parse('{"title":"资源配额","description":"","frontmatter":{},"headers":[],"relativePath":"docker/Cgroups.md","filePath":"docker/Cgroups.md","lastUpdated":1744556347000}'),o={name:"docker/Cgroups.md"};function e(r,s,c,t,y,i){return p(),a("div",null,s[0]||(s[0]=[l(`<h1 id="资源配额" tabindex="-1">资源配额 <a class="header-anchor" href="#资源配额" aria-label="Permalink to &quot;资源配额&quot;">​</a></h1><p>cgroups限制进程的CPU使用时间</p><p><strong>实验</strong></p><p>在宿主机上创建一个让CPU飙升到100%的进程。</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">while</span><span style="color:#56B6C2;"> :</span><span style="color:#ABB2BF;">; </span><span style="color:#C678DD;">do</span><span style="color:#56B6C2;"> :</span><span style="color:#ABB2BF;">; </span><span style="color:#C678DD;">done</span><span style="color:#ABB2BF;"> &amp;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>记录PID=pid</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">top</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">  PID</span><span style="color:#98C379;"> USER</span><span style="color:#98C379;">      PR</span><span style="color:#98C379;">  NI</span><span style="color:#98C379;">    VIRT</span><span style="color:#98C379;">    RES</span><span style="color:#98C379;">    SHR</span><span style="color:#98C379;"> S</span><span style="color:#98C379;">  %CPU</span><span style="color:#98C379;"> %MEM</span><span style="color:#98C379;">     TIME+</span><span style="color:#98C379;"> COMMAND</span></span>
<span class="line"><span style="color:#61AFEF;"> 1965</span><span style="color:#98C379;"> root</span><span style="color:#D19A66;">      25</span><span style="color:#D19A66;">   5</span><span style="color:#D19A66;">  153844</span><span style="color:#D19A66;">   2340</span><span style="color:#D19A66;">    192</span><span style="color:#98C379;"> R</span><span style="color:#D19A66;"> 100.0</span><span style="color:#D19A66;">  0.1</span><span style="color:#98C379;">   0:50.62</span><span style="color:#98C379;"> zsh</span></span>
<span class="line"><span style="color:#61AFEF;">  666</span><span style="color:#98C379;"> chrony</span><span style="color:#D19A66;">    20</span><span style="color:#D19A66;">   0</span><span style="color:#D19A66;">  117808</span><span style="color:#D19A66;">   1728</span><span style="color:#D19A66;">   1304</span><span style="color:#98C379;"> S</span><span style="color:#D19A66;">   0.3</span><span style="color:#D19A66;">  0.0</span><span style="color:#98C379;">   0:00.13</span><span style="color:#98C379;"> chronyd</span></span>
<span class="line"><span style="color:#61AFEF;">  696</span><span style="color:#98C379;"> root</span><span style="color:#D19A66;">      20</span><span style="color:#D19A66;">   0</span><span style="color:#D19A66;">  548208</span><span style="color:#D19A66;">  10908</span><span style="color:#D19A66;">   6772</span><span style="color:#98C379;"> S</span><span style="color:#D19A66;">   0.3</span><span style="color:#D19A66;">  0.3</span><span style="color:#98C379;">   0:00.31</span><span style="color:#98C379;"> NetworkManager</span></span>
<span class="line"><span style="color:#61AFEF;">    1</span><span style="color:#98C379;"> root</span><span style="color:#D19A66;">      20</span><span style="color:#D19A66;">   0</span><span style="color:#D19A66;">  128048</span><span style="color:#D19A66;">   6688</span><span style="color:#D19A66;">   4176</span><span style="color:#98C379;"> S</span><span style="color:#D19A66;">   0.0</span><span style="color:#D19A66;">  0.2</span><span style="color:#98C379;">   0:01.50</span><span style="color:#98C379;"> systemd</span></span>
<span class="line"><span style="color:#61AFEF;">    2</span><span style="color:#98C379;"> root</span><span style="color:#D19A66;">      20</span><span style="color:#D19A66;">   0</span><span style="color:#D19A66;">       0</span><span style="color:#D19A66;">      0</span><span style="color:#D19A66;">      0</span><span style="color:#98C379;"> S</span><span style="color:#D19A66;">   0.0</span><span style="color:#D19A66;">  0.0</span><span style="color:#98C379;">   0:00.01</span><span style="color:#98C379;"> kthreadd</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>限制配额</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#56B6C2;">cd</span><span style="color:#98C379;"> /sys/fs/cgroup/cpu</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">mkdir</span><span style="color:#98C379;"> cgroups_test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">cd</span><span style="color:#98C379;"> cgroups_test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">ll</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> cat</span><span style="color:#98C379;"> cpu.cfs_quota_us</span></span>
<span class="line"><span style="color:#61AFEF;">-1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> cat</span><span style="color:#98C379;"> tasks</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 限制配额20%</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> echo</span><span style="color:#D19A66;"> 20000</span><span style="color:#ABB2BF;"> &gt; </span><span style="color:#98C379;">cpu.cfs_quota_us</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 限制进程</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> echo</span><span style="color:#D19A66;"> 1965</span><span style="color:#ABB2BF;"> &gt; </span><span style="color:#98C379;">tasks</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">top</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">  PID</span><span style="color:#98C379;"> USER</span><span style="color:#98C379;">      PR</span><span style="color:#98C379;">  NI</span><span style="color:#98C379;">    VIRT</span><span style="color:#98C379;">    RES</span><span style="color:#98C379;">    SHR</span><span style="color:#98C379;"> S</span><span style="color:#98C379;">  %CPU</span><span style="color:#98C379;"> %MEM</span><span style="color:#98C379;">     TIME+</span><span style="color:#98C379;"> COMMAND</span></span>
<span class="line"><span style="color:#61AFEF;"> 1965</span><span style="color:#98C379;"> root</span><span style="color:#D19A66;">      25</span><span style="color:#D19A66;">   5</span><span style="color:#D19A66;">  153844</span><span style="color:#D19A66;">   2340</span><span style="color:#D19A66;">    192</span><span style="color:#98C379;"> R</span><span style="color:#D19A66;">  20.3</span><span style="color:#D19A66;">  0.1</span><span style="color:#98C379;">   4:53.60</span><span style="color:#98C379;"> zsh</span></span>
<span class="line"><span style="color:#61AFEF;"> 1066</span><span style="color:#98C379;"> root</span><span style="color:#D19A66;">      20</span><span style="color:#D19A66;">   0</span><span style="color:#D19A66;">  222740</span><span style="color:#D19A66;">   3704</span><span style="color:#D19A66;">   2812</span><span style="color:#98C379;"> S</span><span style="color:#D19A66;">   0.3</span><span style="color:#D19A66;">  0.1</span><span style="color:#98C379;">   0:00.40</span><span style="color:#98C379;"> rsyslogd</span></span>
<span class="line"><span style="color:#61AFEF;"> 1896</span><span style="color:#98C379;"> root</span><span style="color:#D19A66;">      20</span><span style="color:#D19A66;">   0</span><span style="color:#D19A66;">       0</span><span style="color:#D19A66;">      0</span><span style="color:#D19A66;">      0</span><span style="color:#98C379;"> S</span><span style="color:#D19A66;">   0.3</span><span style="color:#D19A66;">  0.0</span><span style="color:#98C379;">   0:00.50</span><span style="color:#98C379;"> kworker/0:1</span></span>
<span class="line"><span style="color:#61AFEF;">    1</span><span style="color:#98C379;"> root</span><span style="color:#D19A66;">      20</span><span style="color:#D19A66;">   0</span><span style="color:#D19A66;">  128048</span><span style="color:#D19A66;">   6688</span><span style="color:#D19A66;">   4176</span><span style="color:#98C379;"> S</span><span style="color:#D19A66;">   0.0</span><span style="color:#D19A66;">  0.2</span><span style="color:#98C379;">   0:01.50</span><span style="color:#98C379;"> systemd</span></span>
<span class="line"><span style="color:#61AFEF;">    2</span><span style="color:#98C379;"> root</span><span style="color:#D19A66;">      20</span><span style="color:#D19A66;">   0</span><span style="color:#D19A66;">       0</span><span style="color:#D19A66;">      0</span><span style="color:#D19A66;">      0</span><span style="color:#98C379;"> S</span><span style="color:#D19A66;">   0.0</span><span style="color:#D19A66;">  0.0</span><span style="color:#98C379;">   0:00.01</span><span style="color:#98C379;"> kthreadd</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><strong>docker测试</strong></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">docker</span><span style="color:#98C379;"> run</span><span style="color:#D19A66;"> -it</span><span style="color:#D19A66;">  --cpus=</span><span style="color:#98C379;">&quot;0.5&quot;</span><span style="color:#98C379;"> nginx</span><span style="color:#98C379;"> /bin/sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;">cd</span><span style="color:#98C379;"> /sys/fs/cgroup/cpu</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">cat</span><span style="color:#98C379;"> cpu.cfs_quota_us</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>`,11)]))}const C=n(o,[["render",e]]);export{A as __pageData,C as default};
