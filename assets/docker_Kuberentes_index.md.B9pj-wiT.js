import{_ as n,c as a,o as l,ah as p}from"./chunks/framework.BrJYEL96.js";const u=JSON.parse('{"title":"Kuberentes","description":"","frontmatter":{},"headers":[],"relativePath":"docker/Kuberentes/index.md","filePath":"docker/Kuberentes/index.md","lastUpdated":1744983778000}'),e={name:"docker/Kuberentes/index.md"};function o(r,s,c,t,i,y){return l(),a("div",null,s[0]||(s[0]=[p(`<h1 id="kuberentes" tabindex="-1">Kuberentes <a class="header-anchor" href="#kuberentes" aria-label="Permalink to &quot;Kuberentes&quot;">​</a></h1><table tabindex="0"><thead><tr><th>web</th><th>desc</th></tr></thead><tbody><tr><td><a href="https://www.bilibili.com/video/BV1PnQzYWE62?spm_id_from=333.788.player.switch&amp;vd_source=30ff36ceecea6590878b11480a681103&amp;p=12" target="_blank" rel="noreferrer">kubernetes video</a></td><td></td></tr><tr><td><a href="https://get.k3s.io/" target="_blank" rel="noreferrer">快速构建集群脚本</a></td><td></td></tr></tbody></table><h3 id="设置主机名" tabindex="-1">设置主机名 <a class="header-anchor" href="#设置主机名" aria-label="Permalink to &quot;设置主机名&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">hostnamectl</span><span style="color:#98C379;"> set-hostname</span><span style="color:#98C379;"> master</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">hostname</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查看操作系统版本 &gt; 7.5</span></span>
<span class="line"><span style="color:#61AFEF;">cat</span><span style="color:#98C379;"> /etc/redhat-release</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="环境搭建" tabindex="-1">环境搭建 <a class="header-anchor" href="#环境搭建" aria-label="Permalink to &quot;环境搭建&quot;">​</a></h2><h3 id="主机域名解析" tabindex="-1">主机域名解析 <a class="header-anchor" href="#主机域名解析" aria-label="Permalink to &quot;主机域名解析&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">vim</span><span style="color:#98C379;"> /etc/hosts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">192.168.109.100</span><span style="color:#98C379;"> master</span></span>
<span class="line"><span style="color:#61AFEF;">192.168.109.101</span><span style="color:#98C379;"> node1</span></span>
<span class="line"><span style="color:#61AFEF;">192.168.109.102</span><span style="color:#98C379;"> node2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="时间同步" tabindex="-1">时间同步 <a class="header-anchor" href="#时间同步" aria-label="Permalink to &quot;时间同步&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#98C379;"> status</span><span style="color:#98C379;"> chronyd</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#98C379;"> start</span><span style="color:#98C379;"> chronyd</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#98C379;"> enable</span><span style="color:#98C379;"> chronyd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">date</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="禁用iptables和firewalld服务" tabindex="-1">禁用iptables和firewalld服务 <a class="header-anchor" href="#禁用iptables和firewalld服务" aria-label="Permalink to &quot;禁用iptables和firewalld服务&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#98C379;"> stop</span><span style="color:#98C379;"> firewalld</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#98C379;"> disable</span><span style="color:#98C379;"> firewalld</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#98C379;"> status</span><span style="color:#98C379;"> iptables</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#98C379;"> stop</span><span style="color:#98C379;"> iptables</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#98C379;"> disable</span><span style="color:#98C379;"> iptables</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="禁用selinux" tabindex="-1">禁用selinux <a class="header-anchor" href="#禁用selinux" aria-label="Permalink to &quot;禁用selinux&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;"> sed</span><span style="color:#D19A66;"> -i</span><span style="color:#98C379;"> &#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39;</span><span style="color:#98C379;"> /etc/selinux/config</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 重启</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#61AFEF;"> getenforce</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="禁用swap" tabindex="-1">禁用swap <a class="header-anchor" href="#禁用swap" aria-label="Permalink to &quot;禁用swap&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">sed</span><span style="color:#D19A66;"> -i</span><span style="color:#98C379;"> &#39;s|/dev/mapper/centos-swap|# /dev/mapper/centos-swap|&#39;</span><span style="color:#98C379;"> /etc/fstab</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> # 重启</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="修改linux的内核参数" tabindex="-1">修改Linux的内核参数 <a class="header-anchor" href="#修改linux的内核参数" aria-label="Permalink to &quot;修改Linux的内核参数&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># vim /etc/sysctl.d/kubernetes.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">net.bridge.bridge-nf-call-ip6tables</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#61AFEF;">net.bridge.bridge-nf-call-iptables</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#61AFEF;">net.ipv4.ip_forward</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># reload</span></span>
<span class="line"><span style="color:#61AFEF;">sysctl</span><span style="color:#D19A66;"> -p</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 加载网桥过滤模块</span></span>
<span class="line"><span style="color:#61AFEF;">modprobe</span><span style="color:#98C379;"> br_netfilter</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查看网桥过滤模块是否加载成功</span></span>
<span class="line"><span style="color:#61AFEF;">lsmod</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#98C379;"> br_netfilter</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="配置ipvs功能" tabindex="-1">配置ipvs功能 <a class="header-anchor" href="#配置ipvs功能" aria-label="Permalink to &quot;配置ipvs功能&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># install ipset and ipvsadm</span></span>
<span class="line"><span style="color:#61AFEF;">yum</span><span style="color:#98C379;"> install</span><span style="color:#D19A66;"> -y</span><span style="color:#98C379;"> ipset</span><span style="color:#98C379;"> ipvsadmin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 添加需要加载的模块写入脚本文件</span></span>
<span class="line"><span style="color:#61AFEF;">cat</span><span style="color:#ABB2BF;"> &lt;&lt;</span><span style="color:#ABB2BF;">EOF</span><span style="color:#ABB2BF;"> &gt; </span><span style="color:#98C379;">/etc/sysconfig/modules/ipvs.modules</span></span>
<span class="line"><span style="color:#98C379;">#!/bin/bash</span></span>
<span class="line"><span style="color:#98C379;">modprobe -- ip_vs</span></span>
<span class="line"><span style="color:#98C379;">modprobe -- ip_vs_rr</span></span>
<span class="line"><span style="color:#98C379;">modprobe -- ip_vs_wrr</span></span>
<span class="line"><span style="color:#98C379;">modprobe -- ip_vs_sh</span></span>
<span class="line"><span style="color:#98C379;">modprobe -- nf_conntrack_ipv4</span></span>
<span class="line"><span style="color:#ABB2BF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># add execute mod for file</span></span>
<span class="line"><span style="color:#61AFEF;">chmod</span><span style="color:#98C379;"> +x</span><span style="color:#98C379;"> /etc/sysconfig/modules/ipvs.modules</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 执行文件</span></span>
<span class="line"><span style="color:#61AFEF;">/bin/bash</span><span style="color:#98C379;"> /etc/sysconfig/modules/ipvs.modules</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查看对应模块是否加载成功</span></span>
<span class="line"><span style="color:#61AFEF;">lsmod</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#D19A66;"> -e</span><span style="color:#98C379;"> ip_vs</span><span style="color:#D19A66;"> -e</span><span style="color:#98C379;"> nf_conntrack_ipv4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">nf_conntrack_ipv4</span><span style="color:#D19A66;">      19149</span><span style="color:#D19A66;">  0</span></span>
<span class="line"><span style="color:#61AFEF;">nf_defrag_ipv4</span><span style="color:#D19A66;">         12729</span><span style="color:#D19A66;">  1</span><span style="color:#98C379;"> nf_conntrack_ipv4</span></span>
<span class="line"><span style="color:#61AFEF;">ip_vs_sh</span><span style="color:#D19A66;">               12688</span><span style="color:#D19A66;">  0</span></span>
<span class="line"><span style="color:#61AFEF;">ip_vs_wrr</span><span style="color:#D19A66;">              12697</span><span style="color:#D19A66;">  0</span></span>
<span class="line"><span style="color:#61AFEF;">ip_vs_rr</span><span style="color:#D19A66;">               12600</span><span style="color:#D19A66;">  0</span></span>
<span class="line"><span style="color:#61AFEF;">ip_vs</span><span style="color:#D19A66;">                 145458</span><span style="color:#D19A66;">  6</span><span style="color:#98C379;"> ip_vs_rr,ip_vs_sh,ip_vs_wrr</span></span>
<span class="line"><span style="color:#61AFEF;">nf_conntrack</span><span style="color:#D19A66;">          143411</span><span style="color:#D19A66;">  2</span><span style="color:#98C379;"> ip_vs,nf_conntrack_ipv4</span></span>
<span class="line"><span style="color:#61AFEF;">libcrc32c</span><span style="color:#D19A66;">              12644</span><span style="color:#D19A66;">  3</span><span style="color:#98C379;"> xfs,ip_vs,nf_conntrack</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="重启" tabindex="-1">重启 <a class="header-anchor" href="#重启" aria-label="Permalink to &quot;重启&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">reboot</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="卸载旧docker" tabindex="-1">卸载旧docker <a class="header-anchor" href="#卸载旧docker" aria-label="Permalink to &quot;卸载旧docker&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#98C379;"> stop</span><span style="color:#98C379;"> docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># or 如果遇到以下错误 删除特定版本的docker</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Transaction check error:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#  file /usr/bin/docker from install of docker-ce-18.06.3.ce-3.el7.x86_64 conflicts with file from package docker-ce-cli-1:26.1.4-1.el7.x86_64</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#  file /usr/share/bash-completion/completions/docker from install of docker-ce-18.06.3.ce-3.el7.x86_64 conflicts with file from package docker-ce-cli-1:26.1.4-1.el7.x86_64</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">yum</span><span style="color:#98C379;"> remove</span><span style="color:#D19A66;"> -y</span><span style="color:#98C379;"> docker-ce-cli-1:26.1.4-1.el7.x86_64</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># or </span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">yum</span><span style="color:#98C379;"> remove</span><span style="color:#D19A66;"> -y</span><span style="color:#98C379;"> docker</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#98C379;">    docker-client</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#98C379;">    docker-client-latest</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#98C379;">    docker-common</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#98C379;">    docker-latest</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#98C379;">    docker-latest-logrotate</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#98C379;">    docker-logrotate</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#98C379;">    docker-selinux</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#98C379;">    docker-engine-selinux</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#98C379;">    docker-engine</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#98C379;">    docker-ce</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="安装docker" tabindex="-1">安装docker <a class="header-anchor" href="#安装docker" aria-label="Permalink to &quot;安装docker&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 切换镜像源</span></span>
<span class="line"><span style="color:#61AFEF;">yum-config-manager</span><span style="color:#D19A66;"> --add-repo</span><span style="color:#98C379;"> https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#61AFEF;">wget</span><span style="color:#98C379;"> https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><span style="color:#D19A66;"> -O</span><span style="color:#98C379;"> /etc/yum.repos.d/docker-ce.repo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">yum</span><span style="color:#98C379;"> makecache</span><span style="color:#98C379;"> fast</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查看镜像源所支持的docker版本</span></span>
<span class="line"><span style="color:#61AFEF;">yum</span><span style="color:#98C379;"> list</span><span style="color:#98C379;"> docker-ce</span><span style="color:#D19A66;"> --showduplicates</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 安装特定版本的docker-ce</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 必须指定--setopt=obsoletes=0 否则会自动安装最高版本</span></span>
<span class="line"><span style="color:#61AFEF;">yum</span><span style="color:#98C379;"> install</span><span style="color:#D19A66;"> -y</span><span style="color:#D19A66;"> --setopt=obsoletes=0</span><span style="color:#98C379;"> docker-ce-18.06.3.ce-3.el7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 添加配置</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># docker 默认使用cgroup driver 为cgroupfs， 而kubernetes推荐使用systemd</span></span>
<span class="line"><span style="color:#61AFEF;">mkdir</span><span style="color:#98C379;"> /etc/docker</span></span>
<span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#98C379;"> tee</span><span style="color:#98C379;"> /etc/docker/daemon.json</span><span style="color:#ABB2BF;"> &lt;&lt;-</span><span style="color:#ABB2BF;">&#39;EOF&#39;</span></span>
<span class="line"><span style="color:#98C379;">{</span></span>
<span class="line"><span style="color:#98C379;">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span></span>
<span class="line"><span style="color:#98C379;">  &quot;registry-mirrors&quot;: [</span></span>
<span class="line"><span style="color:#98C379;">      &quot;https://swr.cn-north-4.myhuaweicloud.com&quot;,</span></span>
<span class="line"><span style="color:#98C379;">      &quot;https://ccr.ccs.tencentyun.com&quot;</span></span>
<span class="line"><span style="color:#98C379;">  ]</span></span>
<span class="line"><span style="color:#98C379;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># start</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#98C379;"> start</span><span style="color:#98C379;"> docker</span></span>
<span class="line"><span style="color:#61AFEF;">docker</span><span style="color:#98C379;"> version</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#98C379;"> enable</span><span style="color:#98C379;"> docker</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="添加kubernetes的阿里云源" tabindex="-1">添加kubernetes的阿里云源 <a class="header-anchor" href="#添加kubernetes的阿里云源" aria-label="Permalink to &quot;添加kubernetes的阿里云源&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">cat</span><span style="color:#ABB2BF;"> &gt;&gt; </span><span style="color:#98C379;">/etc/yum.repos.d/kubernetes.repo</span><span style="color:#ABB2BF;"> &lt;&lt;</span><span style="color:#ABB2BF;">EOF</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#98C379;">[kubernetes]</span></span>
<span class="line"><span style="color:#98C379;">name=Kubernetes</span></span>
<span class="line"><span style="color:#98C379;">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span></span>
<span class="line"><span style="color:#98C379;">enabled=1</span></span>
<span class="line"><span style="color:#98C379;">gpgcheck=1</span></span>
<span class="line"><span style="color:#98C379;">repo_gpgcheck=1</span></span>
<span class="line"><span style="color:#98C379;">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"><span style="color:#ABB2BF;">EOF</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="安装k8s核心组件" tabindex="-1">安装k8s核心组件 <a class="header-anchor" href="#安装k8s核心组件" aria-label="Permalink to &quot;安装k8s核心组件&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># install kubeadm kubelet kubectl</span></span>
<span class="line"><span style="color:#61AFEF;">yum</span><span style="color:#98C379;"> install</span><span style="color:#D19A66;"> -y</span><span style="color:#D19A66;"> --setopt=obsoletes=0</span><span style="color:#98C379;"> kubeadm-1.17.4-0</span><span style="color:#98C379;"> kubelet-1.17.4-0</span><span style="color:#98C379;"> kubectl-1.17.4-0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 配置kubelet的cgroup 编辑/etc/sysconfig/kubelet,添加下面的配置</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#98C379;"> tee</span><span style="color:#98C379;"> /etc/sysconfig/kubelet</span><span style="color:#ABB2BF;"> &lt;&lt;-</span><span style="color:#ABB2BF;">&#39;EOF&#39;</span></span>
<span class="line"><span style="color:#98C379;">KUBELET_CGROUP_ARGS=&quot;-cgroup-driver=systemd&quot;</span></span>
<span class="line"><span style="color:#98C379;">KUBE_PROXY_MODE=&quot;ipvs&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 设置kubelet开机自启</span></span>
<span class="line"><span style="color:#61AFEF;">systemctl</span><span style="color:#98C379;"> enable</span><span style="color:#98C379;"> kubelet</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="准备集群镜像" tabindex="-1">准备集群镜像 <a class="header-anchor" href="#准备集群镜像" aria-label="Permalink to &quot;准备集群镜像&quot;">​</a></h2><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 在安装kubernetes集群之前，必须要提前准备好集群需要的景象，所需镜像可以通过下面命令查看</span></span>
<span class="line"><span style="color:#61AFEF;">kubeadm</span><span style="color:#98C379;"> config</span><span style="color:#98C379;"> images</span><span style="color:#98C379;"> list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">I0322</span><span style="color:#98C379;"> 17:37:13.996185</span><span style="color:#D19A66;">   12414</span><span style="color:#98C379;"> version.go:251]</span><span style="color:#98C379;"> remote</span><span style="color:#98C379;"> version</span><span style="color:#98C379;"> is</span><span style="color:#98C379;"> much</span><span style="color:#98C379;"> newer:</span><span style="color:#98C379;"> v1.32.3</span><span style="color:#ABB2BF;">; </span><span style="color:#61AFEF;">falling</span><span style="color:#98C379;"> back</span><span style="color:#98C379;"> to:</span><span style="color:#98C379;"> stable-1.17</span></span>
<span class="line"><span style="color:#61AFEF;">W0322</span><span style="color:#98C379;"> 17:37:17.635642</span><span style="color:#D19A66;">   12414</span><span style="color:#98C379;"> validation.go:28]</span><span style="color:#98C379;"> Cannot</span><span style="color:#98C379;"> validate</span><span style="color:#98C379;"> kubelet</span><span style="color:#98C379;"> config</span><span style="color:#98C379;"> -</span><span style="color:#98C379;"> no</span><span style="color:#98C379;"> validator</span><span style="color:#98C379;"> is</span><span style="color:#98C379;"> available</span></span>
<span class="line"><span style="color:#61AFEF;">W0322</span><span style="color:#98C379;"> 17:37:17.635665</span><span style="color:#D19A66;">   12414</span><span style="color:#98C379;"> validation.go:28]</span><span style="color:#98C379;"> Cannot</span><span style="color:#98C379;"> validate</span><span style="color:#98C379;"> kube-proxy</span><span style="color:#98C379;"> config</span><span style="color:#98C379;"> -</span><span style="color:#98C379;"> no</span><span style="color:#98C379;"> validator</span><span style="color:#98C379;"> is</span><span style="color:#98C379;"> available</span></span>
<span class="line"><span style="color:#61AFEF;">k8s.gcr.io/kube-apiserver:v1.17.17</span></span>
<span class="line"><span style="color:#61AFEF;">k8s.gcr.io/kube-controller-manager:v1.17.17</span></span>
<span class="line"><span style="color:#61AFEF;">k8s.gcr.io/kube-scheduler:v1.17.17</span></span>
<span class="line"><span style="color:#61AFEF;">k8s.gcr.io/kube-proxy:v1.17.17</span></span>
<span class="line"><span style="color:#61AFEF;">k8s.gcr.io/pause:3.1</span></span>
<span class="line"><span style="color:#61AFEF;">k8s.gcr.io/etcd:3.4.3-0</span></span>
<span class="line"><span style="color:#61AFEF;">k8s.gcr.io/coredns:1.6.5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 下载镜像，此镜像在kubernetes的仓库中，网络原因无法下载，替代方案</span></span>
<span class="line"><span style="color:#E06C75;">images</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">	kube-apiserver:v1.17.4</span></span>
<span class="line"><span style="color:#98C379;">  kube-controller-manager:v1.17.4</span></span>
<span class="line"><span style="color:#98C379;">  kube-scheduler:v1.17.4</span></span>
<span class="line"><span style="color:#98C379;">  kube-proxy:v1.17.4</span></span>
<span class="line"><span style="color:#98C379;">  pause:3.1</span></span>
<span class="line"><span style="color:#98C379;">  etcd:3.4.3-0</span></span>
<span class="line"><span style="color:#98C379;">  coredns:1.6.5</span></span>
<span class="line"><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#E06C75;"> imageName</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> \${</span><span style="color:#E06C75;">images</span><span style="color:#ABB2BF;">[@]} ; </span><span style="color:#C678DD;">do</span></span>
<span class="line"><span style="color:#61AFEF;">	docker</span><span style="color:#98C379;"> pull</span><span style="color:#98C379;"> registry.cn-hangzhou.aliyuncs.com/google_containers/</span><span style="color:#E06C75;">$imageName</span></span>
<span class="line"><span style="color:#61AFEF;">	docker</span><span style="color:#98C379;"> tag</span><span style="color:#98C379;"> registry.cn-hangzhou.aliyuncs.com/google_containers/</span><span style="color:#E06C75;">$imageName</span><span style="color:#98C379;"> k8s.gcr.io/</span><span style="color:#E06C75;">$imageName</span></span>
<span class="line"><span style="color:#61AFEF;">	docker</span><span style="color:#98C379;"> rmi</span><span style="color:#98C379;"> registry.cn-hangzhou.aliyuncs.com/google_containers/</span><span style="color:#E06C75;">$imageName</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;">done</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>制作虚拟机Snapshot</p><p>Clone当前虚拟机，后续worker node 的初始化可以基于这个snapshot进行安装。</p><h3 id="初始化主节点" tabindex="-1">初始化主节点 <a class="header-anchor" href="#初始化主节点" aria-label="Permalink to &quot;初始化主节点&quot;">​</a></h3><blockquote><p>以下初始化都是在<code>master</code>节点完成，<code>node</code>节点不需要。</p></blockquote><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 创建集群</span></span>
<span class="line"><span style="color:#61AFEF;">kubeadm</span><span style="color:#98C379;"> init</span><span style="color:#D19A66;"> --kubernetes-version=v1.17.4</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;">						 --pod-network-cidr=10.244.0.0/16</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;">						 --service-cidr=10.96.0.0/12</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;">             --apiserver-advertise-address=192.168.109.100</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">             </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 创建必要文件</span></span>
<span class="line"><span style="color:#61AFEF;">mkdir</span><span style="color:#D19A66;"> -p</span><span style="color:#E06C75;"> $HOME</span><span style="color:#98C379;">/.kube</span></span>
<span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#98C379;"> cp</span><span style="color:#D19A66;"> -i</span><span style="color:#98C379;"> /etc/kubernetes/admin.conf</span><span style="color:#E06C75;"> $HOME</span><span style="color:#98C379;">/.kube/config</span></span>
<span class="line"><span style="color:#61AFEF;">sudo</span><span style="color:#98C379;"> chown</span><span style="color:#ABB2BF;"> $(</span><span style="color:#61AFEF;">id</span><span style="color:#D19A66;"> -u</span><span style="color:#ABB2BF;">)</span><span style="color:#98C379;">:</span><span style="color:#ABB2BF;">$(</span><span style="color:#61AFEF;">id</span><span style="color:#D19A66;"> -g</span><span style="color:#ABB2BF;">) </span><span style="color:#E06C75;">$HOME</span><span style="color:#98C379;">/.kube/config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># ----------------------------------------------------------</span></span>
<span class="line"><span style="color:#61AFEF;">You</span><span style="color:#98C379;"> should</span><span style="color:#98C379;"> now</span><span style="color:#98C379;"> deploy</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> network</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> cluster.</span></span>
<span class="line"><span style="color:#61AFEF;">Run</span><span style="color:#98C379;"> &quot;kubectl apply -f [podnetwork].yaml&quot;</span><span style="color:#98C379;"> with</span><span style="color:#98C379;"> one</span><span style="color:#98C379;"> of</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> options</span><span style="color:#98C379;"> listed</span><span style="color:#98C379;"> at:</span></span>
<span class="line"><span style="color:#61AFEF;">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Then</span><span style="color:#98C379;"> you</span><span style="color:#98C379;"> can</span><span style="color:#98C379;"> join</span><span style="color:#98C379;"> any</span><span style="color:#98C379;"> number</span><span style="color:#98C379;"> of</span><span style="color:#98C379;"> worker</span><span style="color:#98C379;"> nodes</span><span style="color:#98C379;"> by</span><span style="color:#98C379;"> running</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> following</span><span style="color:#98C379;"> on</span><span style="color:#98C379;"> each</span><span style="color:#98C379;"> as</span><span style="color:#98C379;"> root:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">kubeadm</span><span style="color:#98C379;"> join</span><span style="color:#98C379;"> 192.168.109.100:6443</span><span style="color:#D19A66;"> --token</span><span style="color:#98C379;"> hsr22s.zvy38bd7tiwfkji9</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;">    --discovery-token-ca-cert-hash</span><span style="color:#98C379;"> sha256:7097f58b183a3c31f9b7e170f3b9a266955d2705fc2945e81ffa1f5c55ec8957</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># -----------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查看节点</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> nodes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 重置</span></span>
<span class="line"><span style="color:#61AFEF;">kubeadm</span><span style="color:#98C379;"> reset</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="安装网络插件" tabindex="-1">安装网络插件 <a class="header-anchor" href="#安装网络插件" aria-label="Permalink to &quot;安装网络插件&quot;">​</a></h3><p>kubernetes支持多种网络插件，比如flannel,calico,canal等等。插件使用的是<code>DaemonSet</code>的控制器，选用<code>flannel</code>。</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># get fannel config file</span></span>
<span class="line"><span style="color:#61AFEF;">wget</span><span style="color:#98C379;"> https://ghfast.top/https://github.com/flannel-io/flannel/blob/221a83cab893a4a724aaff0bb53fbfd14a7724e4/Documentation/kube-flannel.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 修改文件中quay.io仓库为quay-mirror.qiniu.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用配置文件启动fannel</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> apply</span><span style="color:#D19A66;"> -f</span><span style="color:#98C379;"> kube-flannel.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 稍等片刻，再次查看集群节点状态</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> nodes</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="服务部署" tabindex="-1">服务部署 <a class="header-anchor" href="#服务部署" aria-label="Permalink to &quot;服务部署&quot;">​</a></h3><p>部署kubernetes集群中一个Nginx程序，测试。</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># deploy nginx</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> create</span><span style="color:#98C379;"> deployment</span><span style="color:#98C379;"> nginx</span><span style="color:#D19A66;"> --image=nginx:1.14-alpine</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># expose port</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> expose</span><span style="color:#98C379;"> deployment</span><span style="color:#98C379;"> nginx</span><span style="color:#D19A66;"> --port=80</span><span style="color:#D19A66;"> --type=NodePort</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查看服务状态</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pod,sevice,svc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">curl</span><span style="color:#98C379;"> http://192.168.109.101:31892</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h1 id="资源管理" tabindex="-1">资源管理 <a class="header-anchor" href="#资源管理" aria-label="Permalink to &quot;资源管理&quot;">​</a></h1><blockquote><p>学习kubernetes的核心，就是学习如何对集群上的Pod、Pod控制器、service、存储等各种资源进行管理操作。</p></blockquote><h3 id="资源管理方式" tabindex="-1">资源管理方式 <a class="header-anchor" href="#资源管理方式" aria-label="Permalink to &quot;资源管理方式&quot;">​</a></h3><table tabindex="0"><thead><tr><th>类型</th><th>操作对象</th><th>适合环境</th><th>有点</th><th>缺点</th><th>示例</th></tr></thead><tbody><tr><td>命令式对象管理</td><td>对象</td><td>测试</td><td>简单</td><td>只能操作对象，无法审计、跟踪</td><td><code>kubectl run nginx-pod --image=nginx:1.17.1 --port=80</code></td></tr><tr><td>命令式对象配置</td><td>文件</td><td>开发</td><td>可以审计、跟踪</td><td>项目大时，配置文件多，操作麻烦</td><td><code>kubectl create/pathc -f nginx-pod.yaml</code></td></tr><tr><td>声明式对象配置</td><td>目录</td><td>开发</td><td>支持目录操作</td><td>意外情况下难以调试</td><td><code>kubectl apply -f nginx-pod.yaml</code></td></tr></tbody></table><h4 id="命令式对象管理" tabindex="-1">命令式对象管理 <a class="header-anchor" href="#命令式对象管理" aria-label="Permalink to &quot;命令式对象管理&quot;">​</a></h4><p><code>kubectl</code>是kubernetes集群的命令行工具，能够对集群本身进行管理，并能够在集群上进行容器化应用安装部署，语法如下：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#ABB2BF;"> [command] [type] [name] [flags]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>command</strong>：制定要对资源执行的操作，如create、get、delete</p><p><strong>type</strong>：指定资源，如deployment、pod、service</p><p><strong>name</strong>：指定资源名称，名称大小写铭感</p><p><strong>flags</strong>：额外可选参数</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># show all pod</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pod</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># shou one pod</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> pod_name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># show detail pod</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> pod_name</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> wide/json/yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="操作" tabindex="-1">操作 <a class="header-anchor" href="#操作" aria-label="Permalink to &quot;操作&quot;">​</a></h5><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#D19A66;"> --help</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> controls</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> Kubernetes</span><span style="color:#98C379;"> cluster</span><span style="color:#98C379;"> manager.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;"> Find</span><span style="color:#98C379;"> more</span><span style="color:#98C379;"> information</span><span style="color:#98C379;"> at:</span><span style="color:#98C379;"> https://kubernetes.io/docs/reference/kubectl/overview/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Basic</span><span style="color:#98C379;"> Commands</span><span style="color:#ABB2BF;"> (Beginner):</span></span>
<span class="line"><span style="color:#61AFEF;">  create</span><span style="color:#98C379;">         Create</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> resource</span><span style="color:#98C379;"> from</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> file</span><span style="color:#98C379;"> or</span><span style="color:#98C379;"> from</span><span style="color:#98C379;"> stdin.</span></span>
<span class="line"><span style="color:#61AFEF;">  expose</span><span style="color:#98C379;">         Take</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> replication</span><span style="color:#98C379;"> controller,</span><span style="color:#98C379;"> service,</span><span style="color:#98C379;"> deployment</span><span style="color:#98C379;"> or</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> and</span><span style="color:#98C379;"> expose</span><span style="color:#98C379;"> it</span><span style="color:#98C379;"> as</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> new</span><span style="color:#98C379;"> Kubernetes</span><span style="color:#98C379;"> Service</span></span>
<span class="line"><span style="color:#61AFEF;">  run</span><span style="color:#98C379;">            Run</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> particular</span><span style="color:#98C379;"> image</span><span style="color:#98C379;"> on</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> cluster</span></span>
<span class="line"><span style="color:#56B6C2;">  set</span><span style="color:#98C379;">            Set</span><span style="color:#98C379;"> specific</span><span style="color:#98C379;"> features</span><span style="color:#98C379;"> on</span><span style="color:#98C379;"> objects</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Basic</span><span style="color:#98C379;"> Commands</span><span style="color:#ABB2BF;"> (Intermediate):</span></span>
<span class="line"><span style="color:#61AFEF;">  explain</span><span style="color:#98C379;">        Documentation</span><span style="color:#98C379;"> of</span><span style="color:#98C379;"> resources</span></span>
<span class="line"><span style="color:#61AFEF;">  get</span><span style="color:#98C379;">            Display</span><span style="color:#98C379;"> one</span><span style="color:#98C379;"> or</span><span style="color:#98C379;"> many</span><span style="color:#98C379;"> resources</span></span>
<span class="line"><span style="color:#61AFEF;">  edit</span><span style="color:#98C379;">           Edit</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> resource</span><span style="color:#98C379;"> on</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> server</span></span>
<span class="line"><span style="color:#61AFEF;">  delete</span><span style="color:#98C379;">         Delete</span><span style="color:#98C379;"> resources</span><span style="color:#98C379;"> by</span><span style="color:#98C379;"> filenames,</span><span style="color:#98C379;"> stdin,</span><span style="color:#98C379;"> resources</span><span style="color:#98C379;"> and</span><span style="color:#98C379;"> names,</span><span style="color:#98C379;"> or</span><span style="color:#98C379;"> by</span><span style="color:#98C379;"> resources</span><span style="color:#98C379;"> and</span><span style="color:#98C379;"> label</span><span style="color:#98C379;"> selector</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Deploy</span><span style="color:#98C379;"> Commands:</span></span>
<span class="line"><span style="color:#61AFEF;">  rollout</span><span style="color:#98C379;">        Manage</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> rollout</span><span style="color:#98C379;"> of</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> resource</span></span>
<span class="line"><span style="color:#61AFEF;">  scale</span><span style="color:#98C379;">          Set</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> new</span><span style="color:#98C379;"> size</span><span style="color:#98C379;"> for</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> Deployment,</span><span style="color:#98C379;"> ReplicaSet</span><span style="color:#98C379;"> or</span><span style="color:#98C379;"> Replication</span><span style="color:#98C379;"> Controller</span></span>
<span class="line"><span style="color:#61AFEF;">  autoscale</span><span style="color:#98C379;">      Auto-scale</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> Deployment,</span><span style="color:#98C379;"> ReplicaSet,</span><span style="color:#98C379;"> or</span><span style="color:#98C379;"> ReplicationController</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Cluster</span><span style="color:#98C379;"> Management</span><span style="color:#98C379;"> Commands:</span></span>
<span class="line"><span style="color:#61AFEF;">  certificate</span><span style="color:#98C379;">    Modify</span><span style="color:#98C379;"> certificate</span><span style="color:#98C379;"> resources.</span></span>
<span class="line"><span style="color:#61AFEF;">  cluster-info</span><span style="color:#98C379;">   Display</span><span style="color:#98C379;"> cluster</span><span style="color:#98C379;"> info</span></span>
<span class="line"><span style="color:#61AFEF;">  top</span><span style="color:#98C379;">            Display</span><span style="color:#98C379;"> Resource</span><span style="color:#ABB2BF;"> (CPU/Memory/Storage) usage.</span></span>
<span class="line"><span style="color:#61AFEF;">  cordon</span><span style="color:#98C379;">         Mark</span><span style="color:#98C379;"> node</span><span style="color:#98C379;"> as</span><span style="color:#98C379;"> unschedulable</span></span>
<span class="line"><span style="color:#61AFEF;">  uncordon</span><span style="color:#98C379;">       Mark</span><span style="color:#98C379;"> node</span><span style="color:#98C379;"> as</span><span style="color:#98C379;"> schedulable</span></span>
<span class="line"><span style="color:#61AFEF;">  drain</span><span style="color:#98C379;">          Drain</span><span style="color:#98C379;"> node</span><span style="color:#98C379;"> in</span><span style="color:#98C379;"> preparation</span><span style="color:#98C379;"> for</span><span style="color:#98C379;"> maintenance</span></span>
<span class="line"><span style="color:#61AFEF;">  taint</span><span style="color:#98C379;">          Update</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> taints</span><span style="color:#98C379;"> on</span><span style="color:#98C379;"> one</span><span style="color:#98C379;"> or</span><span style="color:#98C379;"> more</span><span style="color:#98C379;"> nodes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Troubleshooting</span><span style="color:#98C379;"> and</span><span style="color:#98C379;"> Debugging</span><span style="color:#98C379;"> Commands:</span></span>
<span class="line"><span style="color:#61AFEF;">  describe</span><span style="color:#98C379;">       Show</span><span style="color:#98C379;"> details</span><span style="color:#98C379;"> of</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> specific</span><span style="color:#98C379;"> resource</span><span style="color:#98C379;"> or</span><span style="color:#98C379;"> group</span><span style="color:#98C379;"> of</span><span style="color:#98C379;"> resources</span></span>
<span class="line"><span style="color:#61AFEF;">  logs</span><span style="color:#98C379;">           Print</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> logs</span><span style="color:#98C379;"> for</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> container</span><span style="color:#98C379;"> in</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> pod</span></span>
<span class="line"><span style="color:#61AFEF;">  attach</span><span style="color:#98C379;">         Attach</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> running</span><span style="color:#98C379;"> container</span></span>
<span class="line"><span style="color:#56B6C2;">  exec</span><span style="color:#98C379;">           Execute</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> command</span><span style="color:#98C379;"> in</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> container</span></span>
<span class="line"><span style="color:#61AFEF;">  port-forward</span><span style="color:#98C379;">   Forward</span><span style="color:#98C379;"> one</span><span style="color:#98C379;"> or</span><span style="color:#98C379;"> more</span><span style="color:#98C379;"> local</span><span style="color:#98C379;"> ports</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> pod</span></span>
<span class="line"><span style="color:#61AFEF;">  proxy</span><span style="color:#98C379;">          Run</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> proxy</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> Kubernetes</span><span style="color:#98C379;"> API</span><span style="color:#98C379;"> server</span></span>
<span class="line"><span style="color:#61AFEF;">  cp</span><span style="color:#98C379;">             Copy</span><span style="color:#98C379;"> files</span><span style="color:#98C379;"> and</span><span style="color:#98C379;"> directories</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> and</span><span style="color:#98C379;"> from</span><span style="color:#98C379;"> containers.</span></span>
<span class="line"><span style="color:#61AFEF;">  auth</span><span style="color:#98C379;">           Inspect</span><span style="color:#98C379;"> authorization</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Advanced</span><span style="color:#98C379;"> Commands:</span></span>
<span class="line"><span style="color:#61AFEF;">  diff</span><span style="color:#98C379;">           Diff</span><span style="color:#98C379;"> live</span><span style="color:#98C379;"> version</span><span style="color:#98C379;"> against</span><span style="color:#98C379;"> would-be</span><span style="color:#98C379;"> applied</span><span style="color:#98C379;"> version</span></span>
<span class="line"><span style="color:#61AFEF;">  apply</span><span style="color:#98C379;">          Apply</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> configuration</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> resource</span><span style="color:#98C379;"> by</span><span style="color:#98C379;"> filename</span><span style="color:#98C379;"> or</span><span style="color:#98C379;"> stdin</span></span>
<span class="line"><span style="color:#61AFEF;">  patch</span><span style="color:#98C379;">          Update</span><span style="color:#98C379;"> field</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">s</span><span style="color:#ABB2BF;">) </span><span style="color:#98C379;">of</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> resource</span><span style="color:#98C379;"> using</span><span style="color:#98C379;"> strategic</span><span style="color:#98C379;"> merge</span><span style="color:#98C379;"> patch</span></span>
<span class="line"><span style="color:#61AFEF;">  replace</span><span style="color:#98C379;">        Replace</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> resource</span><span style="color:#98C379;"> by</span><span style="color:#98C379;"> filename</span><span style="color:#98C379;"> or</span><span style="color:#98C379;"> stdin</span></span>
<span class="line"><span style="color:#56B6C2;">  wait</span><span style="color:#98C379;">           Experimental:</span><span style="color:#98C379;"> Wait</span><span style="color:#98C379;"> for</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> specific</span><span style="color:#98C379;"> condition</span><span style="color:#98C379;"> on</span><span style="color:#98C379;"> one</span><span style="color:#98C379;"> or</span><span style="color:#98C379;"> many</span><span style="color:#98C379;"> resources.</span></span>
<span class="line"><span style="color:#61AFEF;">  convert</span><span style="color:#98C379;">        Convert</span><span style="color:#98C379;"> config</span><span style="color:#98C379;"> files</span><span style="color:#98C379;"> between</span><span style="color:#98C379;"> different</span><span style="color:#98C379;"> API</span><span style="color:#98C379;"> versions</span></span>
<span class="line"><span style="color:#61AFEF;">  kustomize</span><span style="color:#98C379;">      Build</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> kustomization</span><span style="color:#98C379;"> target</span><span style="color:#98C379;"> from</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> directory</span><span style="color:#98C379;"> or</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> remote</span><span style="color:#98C379;"> url.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Settings</span><span style="color:#98C379;"> Commands:</span></span>
<span class="line"><span style="color:#61AFEF;">  label</span><span style="color:#98C379;">          Update</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> labels</span><span style="color:#98C379;"> on</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> resource</span></span>
<span class="line"><span style="color:#61AFEF;">  annotate</span><span style="color:#98C379;">       Update</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> annotations</span><span style="color:#98C379;"> on</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> resource</span></span>
<span class="line"><span style="color:#61AFEF;">  completion</span><span style="color:#98C379;">     Output</span><span style="color:#98C379;"> shell</span><span style="color:#98C379;"> completion</span><span style="color:#98C379;"> code</span><span style="color:#98C379;"> for</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> specified</span><span style="color:#98C379;"> shell</span><span style="color:#ABB2BF;"> (bash </span><span style="color:#98C379;">or</span><span style="color:#98C379;"> zsh</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Other</span><span style="color:#98C379;"> Commands:</span></span>
<span class="line"><span style="color:#61AFEF;">  api-resources</span><span style="color:#98C379;">  Print</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> supported</span><span style="color:#98C379;"> API</span><span style="color:#98C379;"> resources</span><span style="color:#98C379;"> on</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> server</span></span>
<span class="line"><span style="color:#61AFEF;">  api-versions</span><span style="color:#98C379;">   Print</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> supported</span><span style="color:#98C379;"> API</span><span style="color:#98C379;"> versions</span><span style="color:#98C379;"> on</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> server,</span><span style="color:#98C379;"> in</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> form</span><span style="color:#98C379;"> of</span><span style="color:#98C379;"> &quot;group/version&quot;</span></span>
<span class="line"><span style="color:#61AFEF;">  config</span><span style="color:#98C379;">         Modify</span><span style="color:#98C379;"> kubeconfig</span><span style="color:#98C379;"> files</span></span>
<span class="line"><span style="color:#61AFEF;">  plugin</span><span style="color:#98C379;">         Provides</span><span style="color:#98C379;"> utilities</span><span style="color:#98C379;"> for</span><span style="color:#98C379;"> interacting</span><span style="color:#98C379;"> with</span><span style="color:#98C379;"> plugins.</span></span>
<span class="line"><span style="color:#61AFEF;">  version</span><span style="color:#98C379;">        Print</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> client</span><span style="color:#98C379;"> and</span><span style="color:#98C379;"> server</span><span style="color:#98C379;"> version</span><span style="color:#98C379;"> information</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Usage:</span></span>
<span class="line"><span style="color:#61AFEF;">  kubectl</span><span style="color:#ABB2BF;"> [flags] [options]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Use</span><span style="color:#98C379;"> &quot;kubectl &lt;command&gt; --help&quot;</span><span style="color:#98C379;"> for</span><span style="color:#98C379;"> more</span><span style="color:#98C379;"> information</span><span style="color:#98C379;"> about</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> given</span><span style="color:#98C379;"> command.</span></span>
<span class="line"><span style="color:#61AFEF;">Use</span><span style="color:#98C379;"> &quot;kubectl options&quot;</span><span style="color:#98C379;"> for</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> list</span><span style="color:#98C379;"> of</span><span style="color:#98C379;"> global</span><span style="color:#98C379;"> command-line</span><span style="color:#98C379;"> options</span><span style="color:#ABB2BF;"> (applies </span><span style="color:#98C379;">to</span><span style="color:#98C379;"> all</span><span style="color:#98C379;"> commands</span><span style="color:#ABB2BF;">).</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><h5 id="资源类型" tabindex="-1">资源类型 <a class="header-anchor" href="#资源类型" aria-label="Permalink to &quot;资源类型&quot;">​</a></h5><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> api-resources</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">NAME</span><span style="color:#98C379;">                              SHORTNAMES</span><span style="color:#98C379;">   APIGROUP</span><span style="color:#98C379;">                       NAMESPACED</span><span style="color:#98C379;">   KIND</span></span>
<span class="line"><span style="color:#61AFEF;">bindings</span><span style="color:#D19A66;">                                                                      true</span><span style="color:#98C379;">         Binding</span></span>
<span class="line"><span style="color:#61AFEF;">componentstatuses</span><span style="color:#98C379;">                 cs</span><span style="color:#D19A66;">                                          false</span><span style="color:#98C379;">        ComponentStatus</span></span>
<span class="line"><span style="color:#61AFEF;">configmaps</span><span style="color:#98C379;">                        cm</span><span style="color:#D19A66;">                                          true</span><span style="color:#98C379;">         ConfigMap</span></span>
<span class="line"><span style="color:#61AFEF;">endpoints</span><span style="color:#98C379;">                         ep</span><span style="color:#D19A66;">                                          true</span><span style="color:#98C379;">         Endpoints</span></span>
<span class="line"><span style="color:#61AFEF;">events</span><span style="color:#98C379;">                            ev</span><span style="color:#D19A66;">                                          true</span><span style="color:#98C379;">         Event</span></span>
<span class="line"><span style="color:#61AFEF;">limitranges</span><span style="color:#98C379;">                       limits</span><span style="color:#D19A66;">                                      true</span><span style="color:#98C379;">         LimitRange</span></span>
<span class="line"><span style="color:#61AFEF;">namespaces</span><span style="color:#98C379;">                        ns</span><span style="color:#D19A66;">                                          false</span><span style="color:#98C379;">        Namespace</span></span>
<span class="line"><span style="color:#61AFEF;">nodes</span><span style="color:#98C379;">                             no</span><span style="color:#D19A66;">                                          false</span><span style="color:#98C379;">        Node</span></span>
<span class="line"><span style="color:#61AFEF;">persistentvolumeclaims</span><span style="color:#98C379;">            pvc</span><span style="color:#D19A66;">                                         true</span><span style="color:#98C379;">         PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#61AFEF;">persistentvolumes</span><span style="color:#98C379;">                 pv</span><span style="color:#D19A66;">                                          false</span><span style="color:#98C379;">        PersistentVolume</span></span>
<span class="line"><span style="color:#61AFEF;">pods</span><span style="color:#98C379;">                              po</span><span style="color:#D19A66;">                                          true</span><span style="color:#98C379;">         Pod</span></span>
<span class="line"><span style="color:#61AFEF;">podtemplates</span><span style="color:#D19A66;">                                                                  true</span><span style="color:#98C379;">         PodTemplate</span></span>
<span class="line"><span style="color:#61AFEF;">replicationcontrollers</span><span style="color:#98C379;">            rc</span><span style="color:#D19A66;">                                          true</span><span style="color:#98C379;">         ReplicationController</span></span>
<span class="line"><span style="color:#61AFEF;">resourcequotas</span><span style="color:#98C379;">                    quota</span><span style="color:#D19A66;">                                       true</span><span style="color:#98C379;">         ResourceQuota</span></span>
<span class="line"><span style="color:#61AFEF;">secrets</span><span style="color:#D19A66;">                                                                       true</span><span style="color:#98C379;">         Secret</span></span>
<span class="line"><span style="color:#61AFEF;">serviceaccounts</span><span style="color:#98C379;">                   sa</span><span style="color:#D19A66;">                                          true</span><span style="color:#98C379;">         ServiceAccount</span></span>
<span class="line"><span style="color:#61AFEF;">services</span><span style="color:#98C379;">                          svc</span><span style="color:#D19A66;">                                         true</span><span style="color:#98C379;">         Service</span></span>
<span class="line"><span style="color:#61AFEF;">mutatingwebhookconfigurations</span><span style="color:#98C379;">                  admissionregistration.k8s.io</span><span style="color:#D19A66;">   false</span><span style="color:#98C379;">        MutatingWebhookConfiguration</span></span>
<span class="line"><span style="color:#61AFEF;">validatingwebhookconfigurations</span><span style="color:#98C379;">                admissionregistration.k8s.io</span><span style="color:#D19A66;">   false</span><span style="color:#98C379;">        ValidatingWebhookConfiguration</span></span>
<span class="line"><span style="color:#61AFEF;">customresourcedefinitions</span><span style="color:#98C379;">         crd,crds</span><span style="color:#98C379;">     apiextensions.k8s.io</span><span style="color:#D19A66;">           false</span><span style="color:#98C379;">        CustomResourceDefinition</span></span>
<span class="line"><span style="color:#61AFEF;">apiservices</span><span style="color:#98C379;">                                    apiregistration.k8s.io</span><span style="color:#D19A66;">         false</span><span style="color:#98C379;">        APIService</span></span>
<span class="line"><span style="color:#61AFEF;">controllerrevisions</span><span style="color:#98C379;">                            apps</span><span style="color:#D19A66;">                           true</span><span style="color:#98C379;">         ControllerRevision</span></span>
<span class="line"><span style="color:#61AFEF;">daemonsets</span><span style="color:#98C379;">                        ds</span><span style="color:#98C379;">           apps</span><span style="color:#D19A66;">                           true</span><span style="color:#98C379;">         DaemonSet</span></span>
<span class="line"><span style="color:#61AFEF;">deployments</span><span style="color:#98C379;">                       deploy</span><span style="color:#98C379;">       apps</span><span style="color:#D19A66;">                           true</span><span style="color:#98C379;">         Deployment</span></span>
<span class="line"><span style="color:#61AFEF;">replicasets</span><span style="color:#98C379;">                       rs</span><span style="color:#98C379;">           apps</span><span style="color:#D19A66;">                           true</span><span style="color:#98C379;">         ReplicaSet</span></span>
<span class="line"><span style="color:#61AFEF;">statefulsets</span><span style="color:#98C379;">                      sts</span><span style="color:#98C379;">          apps</span><span style="color:#D19A66;">                           true</span><span style="color:#98C379;">         StatefulSet</span></span>
<span class="line"><span style="color:#61AFEF;">tokenreviews</span><span style="color:#98C379;">                                   authentication.k8s.io</span><span style="color:#D19A66;">          false</span><span style="color:#98C379;">        TokenReview</span></span>
<span class="line"><span style="color:#61AFEF;">localsubjectaccessreviews</span><span style="color:#98C379;">                      authorization.k8s.io</span><span style="color:#D19A66;">           true</span><span style="color:#98C379;">         LocalSubjectAccessReview</span></span>
<span class="line"><span style="color:#61AFEF;">selfsubjectaccessreviews</span><span style="color:#98C379;">                       authorization.k8s.io</span><span style="color:#D19A66;">           false</span><span style="color:#98C379;">        SelfSubjectAccessReview</span></span>
<span class="line"><span style="color:#61AFEF;">selfsubjectrulesreviews</span><span style="color:#98C379;">                        authorization.k8s.io</span><span style="color:#D19A66;">           false</span><span style="color:#98C379;">        SelfSubjectRulesReview</span></span>
<span class="line"><span style="color:#61AFEF;">subjectaccessreviews</span><span style="color:#98C379;">                           authorization.k8s.io</span><span style="color:#D19A66;">           false</span><span style="color:#98C379;">        SubjectAccessReview</span></span>
<span class="line"><span style="color:#61AFEF;">horizontalpodautoscalers</span><span style="color:#98C379;">          hpa</span><span style="color:#98C379;">          autoscaling</span><span style="color:#D19A66;">                    true</span><span style="color:#98C379;">         HorizontalPodAutoscaler</span></span>
<span class="line"><span style="color:#61AFEF;">cronjobs</span><span style="color:#98C379;">                          cj</span><span style="color:#98C379;">           batch</span><span style="color:#D19A66;">                          true</span><span style="color:#98C379;">         CronJob</span></span>
<span class="line"><span style="color:#56B6C2;">jobs</span><span style="color:#98C379;">                                           batch</span><span style="color:#D19A66;">                          true</span><span style="color:#98C379;">         Job</span></span>
<span class="line"><span style="color:#61AFEF;">certificatesigningrequests</span><span style="color:#98C379;">        csr</span><span style="color:#98C379;">          certificates.k8s.io</span><span style="color:#D19A66;">            false</span><span style="color:#98C379;">        CertificateSigningRequest</span></span>
<span class="line"><span style="color:#61AFEF;">leases</span><span style="color:#98C379;">                                         coordination.k8s.io</span><span style="color:#D19A66;">            true</span><span style="color:#98C379;">         Lease</span></span>
<span class="line"><span style="color:#61AFEF;">endpointslices</span><span style="color:#98C379;">                                 discovery.k8s.io</span><span style="color:#D19A66;">               true</span><span style="color:#98C379;">         EndpointSlice</span></span>
<span class="line"><span style="color:#61AFEF;">events</span><span style="color:#98C379;">                            ev</span><span style="color:#98C379;">           events.k8s.io</span><span style="color:#D19A66;">                  true</span><span style="color:#98C379;">         Event</span></span>
<span class="line"><span style="color:#61AFEF;">ingresses</span><span style="color:#98C379;">                         ing</span><span style="color:#98C379;">          extensions</span><span style="color:#D19A66;">                     true</span><span style="color:#98C379;">         Ingress</span></span>
<span class="line"><span style="color:#61AFEF;">ingresses</span><span style="color:#98C379;">                         ing</span><span style="color:#98C379;">          networking.k8s.io</span><span style="color:#D19A66;">              true</span><span style="color:#98C379;">         Ingress</span></span>
<span class="line"><span style="color:#61AFEF;">networkpolicies</span><span style="color:#98C379;">                   netpol</span><span style="color:#98C379;">       networking.k8s.io</span><span style="color:#D19A66;">              true</span><span style="color:#98C379;">         NetworkPolicy</span></span>
<span class="line"><span style="color:#61AFEF;">runtimeclasses</span><span style="color:#98C379;">                                 node.k8s.io</span><span style="color:#D19A66;">                    false</span><span style="color:#98C379;">        RuntimeClass</span></span>
<span class="line"><span style="color:#61AFEF;">poddisruptionbudgets</span><span style="color:#98C379;">              pdb</span><span style="color:#98C379;">          policy</span><span style="color:#D19A66;">                         true</span><span style="color:#98C379;">         PodDisruptionBudget</span></span>
<span class="line"><span style="color:#61AFEF;">podsecuritypolicies</span><span style="color:#98C379;">               psp</span><span style="color:#98C379;">          policy</span><span style="color:#D19A66;">                         false</span><span style="color:#98C379;">        PodSecurityPolicy</span></span>
<span class="line"><span style="color:#61AFEF;">clusterrolebindings</span><span style="color:#98C379;">                            rbac.authorization.k8s.io</span><span style="color:#D19A66;">      false</span><span style="color:#98C379;">        ClusterRoleBinding</span></span>
<span class="line"><span style="color:#61AFEF;">clusterroles</span><span style="color:#98C379;">                                   rbac.authorization.k8s.io</span><span style="color:#D19A66;">      false</span><span style="color:#98C379;">        ClusterRole</span></span>
<span class="line"><span style="color:#61AFEF;">rolebindings</span><span style="color:#98C379;">                                   rbac.authorization.k8s.io</span><span style="color:#D19A66;">      true</span><span style="color:#98C379;">         RoleBinding</span></span>
<span class="line"><span style="color:#61AFEF;">roles</span><span style="color:#98C379;">                                          rbac.authorization.k8s.io</span><span style="color:#D19A66;">      true</span><span style="color:#98C379;">         Role</span></span>
<span class="line"><span style="color:#61AFEF;">priorityclasses</span><span style="color:#98C379;">                   pc</span><span style="color:#98C379;">           scheduling.k8s.io</span><span style="color:#D19A66;">              false</span><span style="color:#98C379;">        PriorityClass</span></span>
<span class="line"><span style="color:#61AFEF;">csidrivers</span><span style="color:#98C379;">                                     storage.k8s.io</span><span style="color:#D19A66;">                 false</span><span style="color:#98C379;">        CSIDriver</span></span>
<span class="line"><span style="color:#61AFEF;">csinodes</span><span style="color:#98C379;">                                       storage.k8s.io</span><span style="color:#D19A66;">                 false</span><span style="color:#98C379;">        CSINode</span></span>
<span class="line"><span style="color:#61AFEF;">storageclasses</span><span style="color:#98C379;">                    sc</span><span style="color:#98C379;">           storage.k8s.io</span><span style="color:#D19A66;">                 false</span><span style="color:#98C379;">        StorageClass</span></span>
<span class="line"><span style="color:#61AFEF;">volumeattachments</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><p><strong>namespace的创建于删除</strong></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># create</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> create</span><span style="color:#98C379;"> namespace</span><span style="color:#98C379;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># check</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> ns</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># show a nginx pod in dev namespace</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> run</span><span style="color:#98C379;"> pod</span><span style="color:#D19A66;"> --image=nginx</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># check</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pods</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> describe</span><span style="color:#98C379;"> pods</span><span style="color:#98C379;"> pod-864f9875b9-7t9xw</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># delete namespace dev</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> delete</span><span style="color:#98C379;"> ns</span><span style="color:#98C379;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># check</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> namespace</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="命令式对象配置" tabindex="-1">命令式对象配置 <a class="header-anchor" href="#命令式对象配置" aria-label="Permalink to &quot;命令式对象配置&quot;">​</a></h4><p>创建一个nginxpod.yaml</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;">apiVersion</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">v1</span></span>
<span class="line"><span style="color:#E06C75;">kind</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Namespace</span></span>
<span class="line"><span style="color:#E06C75;">metadata</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">---</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">apiVersion</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">v1</span></span>
<span class="line"><span style="color:#E06C75;">kind</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Pod</span></span>
<span class="line"><span style="color:#E06C75;">metadata</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginxpod</span></span>
<span class="line"><span style="color:#E06C75;">    labels</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">        app</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">dev</span></span>
<span class="line"><span style="color:#E06C75;">spec</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    containers</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginx-containers</span></span>
<span class="line"><span style="color:#E06C75;">          image</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginx:1.17.1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>create resource</strong></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> create</span><span style="color:#D19A66;"> -f</span><span style="color:#98C379;"> nginxpod.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="声明式对象配置" tabindex="-1">声明式对象配置 <a class="header-anchor" href="#声明式对象配置" aria-label="Permalink to &quot;声明式对象配置&quot;">​</a></h4><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> apply</span><span style="color:#D19A66;"> -f</span><span style="color:#98C379;"> nginxpod.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> describe</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> nginxpod</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="实战" tabindex="-1">实战 <a class="header-anchor" href="#实战" aria-label="Permalink to &quot;实战&quot;">​</a></h2><h3 id="namespace" tabindex="-1">Namespace <a class="header-anchor" href="#namespace" aria-label="Permalink to &quot;Namespace&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> namespace</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">NAME</span><span style="color:#98C379;">              STATUS</span><span style="color:#98C379;">   AGE</span></span>
<span class="line"><span style="color:#61AFEF;">default</span><span style="color:#98C379;">           Active</span><span style="color:#98C379;">   5h46m</span><span style="color:#7F848E;font-style:italic;"> # 默认</span></span>
<span class="line"><span style="color:#61AFEF;">dev</span><span style="color:#98C379;">               Active</span><span style="color:#98C379;">   55m</span><span style="color:#7F848E;font-style:italic;">   # 新建</span></span>
<span class="line"><span style="color:#61AFEF;">kube-flannel</span><span style="color:#98C379;">      Active</span><span style="color:#98C379;">   4h53m</span><span style="color:#7F848E;font-style:italic;"> # 网络空间</span></span>
<span class="line"><span style="color:#61AFEF;">kube-node-lease</span><span style="color:#98C379;">   Active</span><span style="color:#98C379;">   5h46m</span><span style="color:#7F848E;font-style:italic;"> # 集群节点之间心跳维护</span></span>
<span class="line"><span style="color:#61AFEF;">kube-public</span><span style="color:#98C379;">       Active</span><span style="color:#98C379;">   5h46m</span><span style="color:#7F848E;font-style:italic;"> # 所有人都可以访问（包括未认证用户）</span></span>
<span class="line"><span style="color:#61AFEF;">kube-system</span><span style="color:#98C379;">       Active</span><span style="color:#98C379;">   5h46m</span><span style="color:#7F848E;font-style:italic;"> # 所有由kubernetes系统创建的资源都处于这个命名空间</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># get default</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> ns</span><span style="color:#98C379;"> default</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># get system namespace</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pod</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> kube-system</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">NAME</span><span style="color:#98C379;">                             READY</span><span style="color:#98C379;">   STATUS</span><span style="color:#98C379;">    RESTARTS</span><span style="color:#98C379;">   AGE</span></span>
<span class="line"><span style="color:#61AFEF;">coredns-6955765f44-lkqk8</span><span style="color:#98C379;">         1/1</span><span style="color:#98C379;">     Running</span><span style="color:#D19A66;">   0</span><span style="color:#98C379;">          5h50m</span></span>
<span class="line"><span style="color:#61AFEF;">coredns-6955765f44-rh5zz</span><span style="color:#98C379;">         1/1</span><span style="color:#98C379;">     Running</span><span style="color:#D19A66;">   0</span><span style="color:#98C379;">          5h50m</span></span>
<span class="line"><span style="color:#61AFEF;">etcd-master</span><span style="color:#98C379;">                      1/1</span><span style="color:#98C379;">     Running</span><span style="color:#D19A66;">   0</span><span style="color:#98C379;">          5h50m</span></span>
<span class="line"><span style="color:#61AFEF;">kube-apiserver-master</span><span style="color:#98C379;">            1/1</span><span style="color:#98C379;">     Running</span><span style="color:#D19A66;">   0</span><span style="color:#98C379;">          5h50m</span></span>
<span class="line"><span style="color:#61AFEF;">kube-controller-manager-master</span><span style="color:#98C379;">   1/1</span><span style="color:#98C379;">     Running</span><span style="color:#D19A66;">   0</span><span style="color:#98C379;">          5h50m</span></span>
<span class="line"><span style="color:#61AFEF;">kube-flannel-ds-amd64-8n54r</span><span style="color:#98C379;">      1/1</span><span style="color:#98C379;">     Running</span><span style="color:#D19A66;">   0</span><span style="color:#98C379;">          4h32m</span></span>
<span class="line"><span style="color:#61AFEF;">kube-flannel-ds-amd64-hrrpv</span><span style="color:#98C379;">      1/1</span><span style="color:#98C379;">     Running</span><span style="color:#D19A66;">   0</span><span style="color:#98C379;">          4h32m</span></span>
<span class="line"><span style="color:#61AFEF;">kube-flannel-ds-amd64-hwwnn</span><span style="color:#98C379;">      1/1</span><span style="color:#98C379;">     Running</span><span style="color:#D19A66;">   0</span><span style="color:#98C379;">          4h32m</span></span>
<span class="line"><span style="color:#61AFEF;">kube-proxy-8jkw4</span><span style="color:#98C379;">                 1/1</span><span style="color:#98C379;">     Running</span><span style="color:#D19A66;">   0</span><span style="color:#98C379;">          5h50m</span></span>
<span class="line"><span style="color:#61AFEF;">kube-proxy-jdvdl</span><span style="color:#98C379;">                 1/1</span><span style="color:#98C379;">     Running</span><span style="color:#D19A66;">   0</span><span style="color:#98C379;">          5h35m</span></span>
<span class="line"><span style="color:#61AFEF;">kube-proxy-pgnzk</span><span style="color:#98C379;">                 1/1</span><span style="color:#98C379;">     Running</span><span style="color:#D19A66;">   0</span><span style="color:#98C379;">          5h35m</span></span>
<span class="line"><span style="color:#61AFEF;">kube-scheduler-master</span><span style="color:#98C379;">            1/1</span><span style="color:#98C379;">     Running</span><span style="color:#D19A66;">   0</span><span style="color:#98C379;">          5h50m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># get detail</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pod</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> kube-system</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> wide</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># delete</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> delete</span><span style="color:#98C379;"> ns</span><span style="color:#98C379;"> dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="pod" tabindex="-1">Pod <a class="header-anchor" href="#pod" aria-label="Permalink to &quot;Pod&quot;">​</a></h3><p>kubernetes在集群启动之后，集群中的各个组件都是以pod方式运行的</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pod</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> kube-system</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="创建并运行" tabindex="-1">创建并运行 <a class="header-anchor" href="#创建并运行" aria-label="Permalink to &quot;创建并运行&quot;">​</a></h4><p>kubernetes通过pod控制器来运行pod</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 命令格式： kubectl run (pod控制器名称) [参数]</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> create</span><span style="color:#98C379;"> ns</span><span style="color:#98C379;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> run</span><span style="color:#98C379;"> nginx</span><span style="color:#D19A66;"> --image=nginx:1.17.1</span><span style="color:#D19A66;"> --port=80</span><span style="color:#D19A66;"> --namespace=dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="配置操作" tabindex="-1">配置操作 <a class="header-anchor" href="#配置操作" aria-label="Permalink to &quot;配置操作&quot;">​</a></h4><p>编辑文件<code>pod-nginx.yaml</code></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;">apiVersion</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">v1</span></span>
<span class="line"><span style="color:#E06C75;">kind</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Namespace</span></span>
<span class="line"><span style="color:#E06C75;">metadata</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">---</span></span>
<span class="line"><span style="color:#E06C75;">apiVersion</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">v1</span></span>
<span class="line"><span style="color:#E06C75;">kind</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Pod</span></span>
<span class="line"><span style="color:#E06C75;">metadata</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginxpod</span></span>
<span class="line"><span style="color:#E06C75;">    namespace</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">dev</span></span>
<span class="line"><span style="color:#E06C75;">spec</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    containers</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        - </span><span style="color:#E06C75;">image</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#E06C75;">          name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">pod</span></span>
<span class="line"><span style="color:#E06C75;">          ports</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">              - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginx-port</span></span>
<span class="line"><span style="color:#E06C75;">                containerPort</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">80</span></span>
<span class="line"><span style="color:#E06C75;">                protocol</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">TCP</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>操作</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># create</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> create</span><span style="color:#D19A66;"> -f</span><span style="color:#98C379;"> pod-nginx.yaml</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># delete</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> delete</span><span style="color:#D19A66;"> -f</span><span style="color:#98C379;"> pod-nginx.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="label" tabindex="-1">Label <a class="header-anchor" href="#label" aria-label="Permalink to &quot;Label&quot;">​</a></h3><p>Label是kubernetes系统中的一个重要概念。它的作用就是在资源上添加标识，用来对它们进行区分和选择。Label的特点：</p><ul><li>Label会以key/value键值对的形式附加到各种对象上，如Node、 Pod、 Service等等</li><li>一个资源对象可以定义任意数量的Label，同一个Label也可以被添加到任意数量的资源对象上去</li><li>Label通常在资源对象定义时确定，当然也可以在对象创建后动态添加或者删除</li></ul><p>可以通过Label实现资源的多维度分组，以便灵活、方便地进行资源分配、调度、配置、部署等管理工作。</p><div class="tip custom-block github-alert"><p class="custom-block-title">一些常用的Label示例如下：</p><p></p><ul><li>·版本标签：&quot;version&quot;：&quot;release&quot;， &quot;vers ion&quot;: &quot;stable&quot;</li><li>·环境标签：&quot;environment&quot;：&quot;dev&quot;， &quot;environmer nt&quot;:&quot;test&quot;, &quot;en vironment&quot;:&quot;pro&quot;</li><li>架构标签：&quot;tier&quot;：&quot;frontend&quot;， &quot;tier&quot;：&quot;backend&quot;</li></ul></div><p>标签定义完毕之后，还要考虑到标签的选择，这就要使用到Label Selector，即：</p><ul><li>Label用于给某个资源对象定义标识</li><li>Label Selector用于查询和筛选拥有某些标签的资源对象</li></ul><p>当前有两种Label Selector：</p><ol><li>基于等式的Label Selector <ul><li>name = slave：选择所有包含Label中key=&quot;name&quot;且value=&quot;slave&quot;的对象</li><li>env != product ion：选择所有包括Label中的key=&quot;env&quot;且value不等于&quot;production&quot;的对象</li></ul></li><li>基于集合的Label Selector <ul><li>name in (master, slave)：选择所有包含Label中key=&quot;name&quot;且value=&quot;slave&quot;或value=&quot;slave&quot;的对象</li><li>name not in (frontend)：选择所有包括Label中的key=&quot;name&quot;且value不等于&quot;frontend&quot;的对象</li></ul></li></ol><p>标签选择条件可以使用多个，此时将多个Label Selector进行组合，使用逗号<code>,</code>隔开即可。</p><h4 id="命令式打标签" tabindex="-1">命令式打标签 <a class="header-anchor" href="#命令式打标签" aria-label="Permalink to &quot;命令式打标签&quot;">​</a></h4><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># label</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> label</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> nginx</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span><span style="color:#98C379;"> version=</span><span style="color:#D19A66;">1.0</span><span style="color:#ABB2BF;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># check label</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pod</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> wide</span><span style="color:#D19A66;"> --show-labels</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># update</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> label</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> nginx</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span><span style="color:#98C379;"> version=</span><span style="color:#D19A66;">2.0</span><span style="color:#D19A66;"> --overwrite</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># filter</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pod</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> wide</span><span style="color:#D19A66;"> -l</span><span style="color:#98C379;"> &quot;version=2.0&quot;</span><span style="color:#D19A66;"> --show-labels</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pod</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> wide</span><span style="color:#D19A66;"> -l</span><span style="color:#98C379;"> &quot;version!=2.0&quot;</span><span style="color:#D19A66;"> --show-labels</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># delete label</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> label</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> nginx</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span><span style="color:#98C379;"> tier-</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="配置方式打标签" tabindex="-1">配置方式打标签 <a class="header-anchor" href="#配置方式打标签" aria-label="Permalink to &quot;配置方式打标签&quot;">​</a></h4><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;">apiVersion</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">v1</span></span>
<span class="line"><span style="color:#E06C75;">kind</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Pod</span></span>
<span class="line"><span style="color:#E06C75;">metadata</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginx</span></span>
<span class="line"><span style="color:#E06C75;">    namespace</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">dev</span></span>
<span class="line"><span style="color:#E06C75;">    labels</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">        version</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;3.0&#39;</span></span>
<span class="line"><span style="color:#E06C75;">        evn</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;test&#39;</span></span>
<span class="line"><span style="color:#E06C75;">spec</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    containers</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        - </span><span style="color:#E06C75;">image</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#E06C75;">          name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">pod</span></span>
<span class="line"><span style="color:#E06C75;">          ports</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">              - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginx-port</span></span>
<span class="line"><span style="color:#E06C75;">                containerPort</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">80</span></span>
<span class="line"><span style="color:#E06C75;">                protocol</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">TCP</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>执行</strong></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> apply</span><span style="color:#D19A66;"> -f</span><span style="color:#98C379;"> pod-nginx.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="deployment" tabindex="-1">Deployment <a class="header-anchor" href="#deployment" aria-label="Permalink to &quot;Deployment&quot;">​</a></h3><h4 id="命令操作" tabindex="-1">命令操作 <a class="header-anchor" href="#命令操作" aria-label="Permalink to &quot;命令操作&quot;">​</a></h4><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 命令格式： kubectl run deployment名称 [参数]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;"> kubectl</span><span style="color:#98C379;"> run</span><span style="color:#98C379;"> nginx</span><span style="color:#D19A66;"> --image=nginx:1.17.1</span><span style="color:#D19A66;"> --port=80</span><span style="color:#D19A66;">  --replicas=3</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># check</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> deployment,pod</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> wide</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">NAME</span><span style="color:#98C379;">                    READY</span><span style="color:#98C379;">   UP-TO-DATE</span><span style="color:#98C379;">   AVAILABLE</span><span style="color:#98C379;">   AGE</span><span style="color:#98C379;">    CONTAINERS</span><span style="color:#98C379;">   IMAGES</span><span style="color:#98C379;">         SELECTOR</span></span>
<span class="line"><span style="color:#61AFEF;">deployment.apps/nginx</span><span style="color:#98C379;">   3/3</span><span style="color:#D19A66;">     3</span><span style="color:#D19A66;">            3</span><span style="color:#98C379;">           2m3s</span><span style="color:#98C379;">   nginx</span><span style="color:#98C379;">        nginx:1.17.1</span><span style="color:#98C379;">   run=nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">NAME</span><span style="color:#98C379;">                         READY</span><span style="color:#98C379;">   STATUS</span><span style="color:#98C379;">    RESTARTS</span><span style="color:#98C379;">   AGE</span><span style="color:#98C379;">    IP</span><span style="color:#98C379;">            NODE</span><span style="color:#98C379;">    NOMINATED</span><span style="color:#98C379;"> NODE</span><span style="color:#98C379;">   READINESS</span><span style="color:#98C379;"> GATES</span></span>
<span class="line"><span style="color:#61AFEF;">pod/nginx-64777cd554-mhc5k</span><span style="color:#98C379;">   1/1</span><span style="color:#98C379;">     Running</span><span style="color:#D19A66;">   0</span><span style="color:#98C379;">          2m3s</span><span style="color:#D19A66;">   10.244.1.8</span><span style="color:#98C379;">    node2</span><span style="color:#ABB2BF;">   &lt;</span><span style="color:#98C379;">non</span><span style="color:#ABB2BF;">e&gt;           &lt;</span><span style="color:#98C379;">non</span><span style="color:#ABB2BF;">e&gt;</span></span>
<span class="line"><span style="color:#61AFEF;">pod/nginx-64777cd554-sbv7g</span><span style="color:#98C379;">   1/1</span><span style="color:#98C379;">     Running</span><span style="color:#D19A66;">   0</span><span style="color:#98C379;">          2m3s</span><span style="color:#D19A66;">   10.244.2.24</span><span style="color:#98C379;">   node1</span><span style="color:#ABB2BF;">   &lt;</span><span style="color:#98C379;">non</span><span style="color:#ABB2BF;">e&gt;           &lt;</span><span style="color:#98C379;">non</span><span style="color:#ABB2BF;">e&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># describe </span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> describe</span><span style="color:#98C379;"> deployment</span><span style="color:#98C379;"> nginx</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pod</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> wide</span><span style="color:#D19A66;"> --show-labels</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># delete</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> delete</span><span style="color:#98C379;"> deploy</span><span style="color:#98C379;"> nginx</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="配置操作-1" tabindex="-1">配置操作 <a class="header-anchor" href="#配置操作-1" aria-label="Permalink to &quot;配置操作&quot;">​</a></h4><p>创建<code>deploy-nginx.yaml</code></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;">apiVersion</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">apps/v1</span></span>
<span class="line"><span style="color:#E06C75;">kind</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Deployment</span></span>
<span class="line"><span style="color:#E06C75;">metadata</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginx</span></span>
<span class="line"><span style="color:#E06C75;">    namespace</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">dev</span></span>
<span class="line"><span style="color:#E06C75;">    labels</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">        version</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;3.0&#39;</span></span>
<span class="line"><span style="color:#E06C75;">        evn</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;test&#39;</span></span>
<span class="line"><span style="color:#E06C75;">spec</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    replicas</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">3</span></span>
<span class="line"><span style="color:#E06C75;">    selector</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">        matchLabels</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">            run</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginx</span></span>
<span class="line"><span style="color:#E06C75;">    template</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">        metadata</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">            labels</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">                run</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginx</span></span>
<span class="line"><span style="color:#E06C75;">        spec</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">            containers</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                - </span><span style="color:#E06C75;">image</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#E06C75;">                  name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginx</span></span>
<span class="line"><span style="color:#E06C75;">                  ports</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">                      - </span><span style="color:#E06C75;">containerPort</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">80</span></span>
<span class="line"><span style="color:#E06C75;">                        protocol</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">TCP</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>操作</strong></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># create</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> create</span><span style="color:#D19A66;"> -f</span><span style="color:#98C379;"> deploy-nginx.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># check </span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> deployment,pod</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> wide</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># delete</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> delete</span><span style="color:#D19A66;"> -f</span><span style="color:#98C379;"> deploy-nginx.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="services" tabindex="-1">Services <a class="header-anchor" href="#services" aria-label="Permalink to &quot;Services&quot;">​</a></h3><p>Service可以看作是一组同类的Pod对外访问的接口，借助Service，应用可以方便地实现服务发现和负载均衡。</p><p><strong>集群内部访问</strong></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># create service</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> expose</span><span style="color:#98C379;"> deployment</span><span style="color:#98C379;"> nginx</span><span style="color:#D19A66;"> --name=svc-nginx1</span><span style="color:#D19A66;"> --type=ClusterIP</span><span style="color:#D19A66;"> --port=80</span><span style="color:#D19A66;"> --target-port=80</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># check</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> svc</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>集群外部访问的Service</strong></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># create service</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> expose</span><span style="color:#98C379;"> deployment</span><span style="color:#98C379;"> nginx</span><span style="color:#D19A66;"> --name=svc-nginx2</span><span style="color:#D19A66;"> --type=NodePort</span><span style="color:#D19A66;"> --port=80</span><span style="color:#D19A66;"> --target-port=80</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># check 发现出现了NodePort类型的Service，而且有一对Port（80:31928/TCP）</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> svc</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">curl</span><span style="color:#98C379;"> http://192.168.109.100:31467/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 若无法访问则坚持ip</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> describe</span><span style="color:#98C379;"> nodes</span><span style="color:#98C379;"> node1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Annotations:</span><span style="color:#98C379;">        flannel.alpha.coreos.com/backend-data:</span><span style="color:#98C379;"> {&quot;VtepMAC&quot;:&quot;fe:24:70:68:3a:4d&quot;}</span></span>
<span class="line"><span style="color:#61AFEF;">                    flannel.alpha.coreos.com/backend-type:</span><span style="color:#98C379;"> vxlan</span></span>
<span class="line"><span style="color:#61AFEF;">                    flannel.alpha.coreos.com/kube-subnet-manager:</span><span style="color:#D19A66;"> true</span></span>
<span class="line highlighted"><span style="color:#61AFEF;">                    flannel.alpha.coreos.com/public-ip:</span><span style="color:#D19A66;"> 192.168.0.105</span></span>
<span class="line"><span style="color:#61AFEF;">                    kubeadm.alpha.kubernetes.io/cri-socket:</span><span style="color:#98C379;"> /var/run/dockershim.sock</span></span>
<span class="line"><span style="color:#61AFEF;">                    node.alpha.kubernetes.io/ttl:</span><span style="color:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#61AFEF;">                    volumes.kubernetes.io/controller-managed-attach-detach:</span><span style="color:#D19A66;"> true</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="配置方式" tabindex="-1">配置方式 <a class="header-anchor" href="#配置方式" aria-label="Permalink to &quot;配置方式&quot;">​</a></h4><p>创建<code>svc-nginx.yaml</code></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;">apiVersion</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">v1</span></span>
<span class="line"><span style="color:#E06C75;">kind</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Service</span></span>
<span class="line"><span style="color:#E06C75;">metadata</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">svc-nginx</span></span>
<span class="line"><span style="color:#E06C75;">    namespace</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">dev</span></span>
<span class="line"><span style="color:#E06C75;">    labels</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">        version</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;3.0&#39;</span></span>
<span class="line"><span style="color:#E06C75;">        evn</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;test&#39;</span></span>
<span class="line"><span style="color:#E06C75;">spec</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    ports</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">        - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">http</span></span>
<span class="line"><span style="color:#E06C75;">          port</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">80</span></span>
<span class="line"><span style="color:#E06C75;">          protocol</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">TCP</span></span>
<span class="line"><span style="color:#E06C75;">          targetPort</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">80</span></span>
<span class="line"><span style="color:#E06C75;">    selector</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">        run</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nginx</span></span>
<span class="line"><span style="color:#E06C75;">    type</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">ClusterIP</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki one-dark-pro vp-code" style="background-color:#282c34;color:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> create</span><span style="color:#D19A66;"> -f</span><span style="color:#98C379;"> svc-nginx.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,115)]))}const d=n(e,[["render",o]]);export{u as __pageData,d as default};
